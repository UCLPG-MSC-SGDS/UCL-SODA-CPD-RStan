<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Bayesian Hierarchical Regression Models | Introduction to Bayesian Inference and Modelling (June 2025)</title>
  <meta name="description" content="Introduction to Bayesian Inference and Modelling" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Bayesian Hierarchical Regression Models | Introduction to Bayesian Inference and Modelling (June 2025)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Introduction to Bayesian Inference and Modelling" />
  <meta name="github-repo" content="UCLPG-MSC-SGDS/UCL-SODA-CPD-RStan" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Bayesian Hierarchical Regression Models | Introduction to Bayesian Inference and Modelling (June 2025)" />
  
  <meta name="twitter:description" content="Introduction to Bayesian Inference and Modelling" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-generalised-linear-models-glms.html"/>
<link rel="next" href="bayesian-spatial-modelling-for-areal-data-in-stan.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/social-data/home/social-data-institute"><img src="images/general/SODA_logo_only.jpg">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#timetable-schedule-location"><i class="fa fa-check"></i>Timetable, Schedule &amp; Location</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-contact-details"><i class="fa fa-check"></i>My Contact Details</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html"><i class="fa fa-check"></i>Reading List</a>
<ul>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-1-introduction-to-probability-distributions"><i class="fa fa-check"></i>Day 1: Introduction to Probability Distributions</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-2-introduction-to-bayesian-inference"><i class="fa fa-check"></i>Day 2: Introduction to Bayesian Inference</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-3-bayesian-generalised-linear-models-glms"><i class="fa fa-check"></i>Day 3: Bayesian Generalised Linear Models (GLMs)</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-4-bayesian-hierarchical-regression-models"><i class="fa fa-check"></i>Day 4: Bayesian Hierarchical Regression Models</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-5-bayesian-spatial-modelling-for-areal-data-in-stan"><i class="fa fa-check"></i>Day 5: Bayesian Spatial Modelling for Areal Data in Stan</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html"><i class="fa fa-check"></i><b>1</b> Installation of R, RStudio &amp; Stan</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#what-is-stan"><i class="fa fa-check"></i><b>1.1</b> What is Stan?</a></li>
<li class="chapter" data-level="1.2" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-of-r-rstudio"><i class="fa fa-check"></i><b>1.2</b> Installation of R &amp; RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-process-for-mac-users"><i class="fa fa-check"></i><b>1.2.1</b> Installation process for MAC users</a></li>
<li class="chapter" data-level="1.2.2" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-process-for-windows-users"><i class="fa fa-check"></i><b>1.2.2</b> Installation process for Windows users</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-of-rstan-or-stan-other-important-r-packages"><i class="fa fa-check"></i><b>1.3</b> Installation of <code>rstan</code> (or Stan) &amp; other important r-packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html"><i class="fa fa-check"></i><b>2</b> Introduction to Stan Programming</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#lectures-length-15555"><i class="fa fa-check"></i><b>2.1.1</b> Lectures (Length: 1:55:55)</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#learning-outcomes"><i class="fa fa-check"></i><b>2.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.1.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#demonstration-length-10838"><i class="fa fa-check"></i><b>2.1.3</b> Demonstration (Length: 1:08:38)</a></li>
<li class="chapter" data-level="2.1.4" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#setting-up-the-work-directory"><i class="fa fa-check"></i><b>2.1.4</b> Setting up the work directory</a></li>
<li class="chapter" data-level="2.1.5" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#loading-packages"><i class="fa fa-check"></i><b>2.1.5</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#about-stan-programming"><i class="fa fa-check"></i><b>2.2</b> About Stan Programming</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-i-opening-a-stan-script-in-rstudio"><i class="fa fa-check"></i><b>2.2.1</b> Basic building blocks I: Opening a Stan Script in RStudio</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-ii-structure-of-a-stan-script"><i class="fa fa-check"></i><b>2.2.2</b> Basic building blocks II: Structure of a Stan script</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-iii-data-types-and-constraint-declarations"><i class="fa fa-check"></i><b>2.2.3</b> Basic building blocks III: Data types and constraint declarations</a></li>
<li class="chapter" data-level="2.2.4" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-iv-developing-our-model"><i class="fa fa-check"></i><b>2.2.4</b> Basic building blocks IV: Developing our model</a></li>
<li class="chapter" data-level="2.2.5" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-v-compiling-stan-code-in-rstudio"><i class="fa fa-check"></i><b>2.2.5</b> Basic building blocks V: Compiling Stan code in RStudio</a></li>
<li class="chapter" data-level="2.2.6" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-vi-extract-posterior-samples-interpretation"><i class="fa fa-check"></i><b>2.2.6</b> Basic building blocks VI: Extract posterior samples &amp; interpretation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#tasks"><i class="fa fa-check"></i><b>2.3</b> Tasks</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#task-1---simulating-and-estimating-body-mass-index-bmi"><i class="fa fa-check"></i><b>2.3.1</b> Task 1 - Simulating and Estimating Body Mass Index (BMI)</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#task-2---low-level-arsenic-poisoning-in-cornwall-uk"><i class="fa fa-check"></i><b>2.3.2</b> Task 2 - Low-level arsenic poisoning in Cornwall, UK</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html"><i class="fa fa-check"></i><b>3</b> Introduction to Bayesian Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#lectures-length-11522"><i class="fa fa-check"></i><b>3.1.1</b> Lectures (Length: 1:15:22)</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#learning-outcomes-1"><i class="fa fa-check"></i><b>3.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#demonstration-length-12254"><i class="fa fa-check"></i><b>3.1.3</b> Demonstration (Length: 1:22:54)</a></li>
<li class="chapter" data-level="3.1.4" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#setting-up-the-work-directory-1"><i class="fa fa-check"></i><b>3.1.4</b> Setting up the work directory</a></li>
<li class="chapter" data-level="3.1.5" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#loading-packages-1"><i class="fa fa-check"></i><b>3.1.5</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#input-data-process-model-and-assumptions-for-priors"><i class="fa fa-check"></i><b>3.2</b> Input: Data, Process Model and Assumptions for Priors</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#compiling-stan-code-in-rstudio"><i class="fa fa-check"></i><b>3.3</b> Compiling Stan code in RStudio</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#tasks-1"><i class="fa fa-check"></i><b>3.4</b> Tasks</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#task-1---aedes-borne-infestation-in-recife-052023"><i class="fa fa-check"></i><b>3.4.1</b> Task 1 - Aedes-borne infestation in Recife 05/2023</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html"><i class="fa fa-check"></i><b>4</b> Bayesian Generalised Linear Models (GLMs)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#lectures-length-10416"><i class="fa fa-check"></i><b>4.1.1</b> Lectures (Length: 1:04:16)</a></li>
<li class="chapter" data-level="4.1.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#learning-outcomes-2"><i class="fa fa-check"></i><b>4.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.1.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#demonstration-part-i-length-15936"><i class="fa fa-check"></i><b>4.1.3</b> Demonstration [Part I] (Length: 1:59:36)</a></li>
<li class="chapter" data-level="4.1.4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#demonstration-part-ii-length-11338"><i class="fa fa-check"></i><b>4.1.4</b> Demonstration [Part II] (Length: 1:13:38)</a></li>
<li class="chapter" data-level="4.1.5" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#datasets-setting-up-the-work-directory"><i class="fa fa-check"></i><b>4.1.5</b> Datasets &amp; setting up the work directory</a></li>
<li class="chapter" data-level="4.1.6" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#loading-and-installing-packages"><i class="fa fa-check"></i><b>4.1.6</b> Loading and installing packages</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#poisson-regression-modelling"><i class="fa fa-check"></i><b>4.2</b> Poisson Regression Modelling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#selecting-the-appropriate-poisson-model"><i class="fa fa-check"></i><b>4.2.1</b> Selecting the appropriate Poisson model</a></li>
<li class="chapter" data-level="4.2.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan"><i class="fa fa-check"></i><b>4.2.2</b> Data preparation and set-up for Bayesian analysis in Stan</a></li>
<li class="chapter" data-level="4.2.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#creating-a-script-to-run-a-negative-binomial-poisson-regression-in-stan"><i class="fa fa-check"></i><b>4.2.3</b> Creating a script to run a Negative Binomial Poisson regression in Stan</a></li>
<li class="chapter" data-level="4.2.4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#compiling-our-stan-code-in-rstudio-and-results"><i class="fa fa-check"></i><b>4.2.4</b> Compiling our Stan code in RStudio and Results</a></li>
<li class="chapter" data-level="4.2.5" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#model-with-categorical-variables"><i class="fa fa-check"></i><b>4.2.5</b> Model with categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#tasks-2"><i class="fa fa-check"></i><b>4.3</b> Tasks</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#task-1---obesity-and-fastfoods-in-london"><i class="fa fa-check"></i><b>4.3.1</b> Task 1 - Obesity and Fastfoods in London</a></li>
<li class="chapter" data-level="4.3.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#task-2---factors-affecting-house-prices-in-london-2015"><i class="fa fa-check"></i><b>4.3.2</b> Task 2 - Factors affecting house prices in London (2015)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html"><i class="fa fa-check"></i><b>5</b> Bayesian Hierarchical Regression Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#lectures-length-10443"><i class="fa fa-check"></i><b>5.1.1</b> Lectures (Length: 1:04:43)</a></li>
<li class="chapter" data-level="5.1.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#learning-outcomes-3"><i class="fa fa-check"></i><b>5.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.1.3" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#demonstration-part-i-length-15740"><i class="fa fa-check"></i><b>5.1.3</b> Demonstration [Part I] (Length: 1:57:40)</a></li>
<li class="chapter" data-level="5.1.4" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#demonstration-part-ii-length-10148"><i class="fa fa-check"></i><b>5.1.4</b> Demonstration [Part II] (Length: 1:01:48)</a></li>
<li class="chapter" data-level="5.1.5" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#datasets-setting-up-the-work-directory-1"><i class="fa fa-check"></i><b>5.1.5</b> Datasets &amp; setting up the work directory</a></li>
<li class="chapter" data-level="5.1.6" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#loading-packages-2"><i class="fa fa-check"></i><b>5.1.6</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan-1"><i class="fa fa-check"></i><b>5.2</b> Data preparation and set-up for Bayesian analysis in Stan</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#creating-a-script-to-run-a-2-level-multilevel-linear-regression-in-stan"><i class="fa fa-check"></i><b>5.2.1</b> Creating a script to run a 2-level Multilevel linear regression in Stan</a></li>
<li class="chapter" data-level="5.2.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#compiling-our-stan-code-for-hierarchical-modelling"><i class="fa fa-check"></i><b>5.2.2</b> Compiling our Stan code for Hierarchical Modelling</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#task"><i class="fa fa-check"></i><b>5.3</b> Task</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html"><i class="fa fa-check"></i><b>6</b> Bayesian Spatial Modelling for Areal Data in Stan</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#lectures-tbc"><i class="fa fa-check"></i><b>6.1.1</b> Lectures (TBC)</a></li>
<li class="chapter" data-level="6.1.2" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#learning-outcomes-4"><i class="fa fa-check"></i><b>6.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.1.3" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#demonstration-tbc"><i class="fa fa-check"></i><b>6.1.3</b> Demonstration (TBC)</a></li>
<li class="chapter" data-level="6.1.4" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#loading-packages-3"><i class="fa fa-check"></i><b>6.1.4</b> Loading packages</a></li>
<li class="chapter" data-level="6.1.5" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#datasets-setting-up-the-work-directory-2"><i class="fa fa-check"></i><b>6.1.5</b> Datasets &amp; setting up the work directory</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#data-preparation-in-rstudio"><i class="fa fa-check"></i><b>6.2</b> Data preparation in RStudio</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#calculation-for-expected-numbers"><i class="fa fa-check"></i><b>6.2.1</b> Calculation for expected numbers</a></li>
<li class="chapter" data-level="6.2.2" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#converting-the-spatial-adjacency-matrix-to-nodes-edges"><i class="fa fa-check"></i><b>6.2.2</b> Converting the spatial adjacency matrix to nodes &amp; edges</a></li>
<li class="chapter" data-level="6.2.3" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#create-the-dataset-to-be-compiled-in-stan"><i class="fa fa-check"></i><b>6.2.3</b> Create the dataset to be compiled in Stan</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#creating-the-script-for-the-spatial-icar-model"><i class="fa fa-check"></i><b>6.3</b> Creating the script for the Spatial ICAR model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#data-block"><i class="fa fa-check"></i><b>6.3.1</b> Data block</a></li>
<li class="chapter" data-level="6.3.2" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>6.3.2</b> Transformed data block</a></li>
<li class="chapter" data-level="6.3.3" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>6.3.3</b> Parameters block</a></li>
<li class="chapter" data-level="6.3.4" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#transformed-parameters-block"><i class="fa fa-check"></i><b>6.3.4</b> Transformed parameters block</a></li>
<li class="chapter" data-level="6.3.5" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#model-block"><i class="fa fa-check"></i><b>6.3.5</b> Model block</a></li>
<li class="chapter" data-level="6.3.6" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>6.3.6</b> Generated quantities block</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#compiling-stan-code-for-the-spatial-icar-risk-modelling"><i class="fa fa-check"></i><b>6.4</b> Compiling Stan code for the Spatial ICAR risk modelling</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#printing-of-the-global-results"><i class="fa fa-check"></i><b>6.4.1</b> Printing of the global results</a></li>
<li class="chapter" data-level="6.4.2" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#rapid-diagnostics-of-the-rhats"><i class="fa fa-check"></i><b>6.4.2</b> Rapid diagnostics of the rHATs</a></li>
<li class="chapter" data-level="6.4.3" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#extraction-of-the-area-specific-relative-risks"><i class="fa fa-check"></i><b>6.4.3</b> Extraction of the area-specific relative risks</a></li>
<li class="chapter" data-level="6.4.4" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#mapping-of-rr-and-significance"><i class="fa fa-check"></i><b>6.4.4</b> Mapping of RR and significance</a></li>
<li class="chapter" data-level="6.4.5" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#extracting-and-mapping-of-the-exceedance-probabilities"><i class="fa fa-check"></i><b>6.4.5</b> Extracting and mapping of the exceedance probabilities</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="bayesian-spatial-modelling-for-areal-data-in-stan.html"><a href="bayesian-spatial-modelling-for-areal-data-in-stan.html#task-1"><i class="fa fa-check"></i><b>6.5</b> Task</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Inference and Modelling (June 2025)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-hierarchical-regression-models" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Bayesian Hierarchical Regression Models<a href="bayesian-hierarchical-regression-models.html#bayesian-hierarchical-regression-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-3" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction<a href="bayesian-hierarchical-regression-models.html#introduction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="lectures-length-10443" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Lectures (Length: 1:04:43)<a href="bayesian-hierarchical-regression-models.html#lectures-length-10443" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/Aq_rfGHYj6Q" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/Aq_rfGHYj6Q">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="learning-outcomes-3" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Learning outcomes<a href="bayesian-hierarchical-regression-models.html#learning-outcomes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will learn how to perform hierarchical regression modelling within a Bayesian framework. These models are useful and robust especially if there’s a hierarchical structure in the dataset. This artefact must be taken into account to ensure statistical robustness. We will focus on implementing 2-level hierarchical regressions with an example of a model that has a <strong>varying intercept</strong> and <strong>varying-slope coefficients</strong>. These models are quite simple to pull off in Stan once you get the gist of it.</p>
<p>You can follow the live walkthrough demonstration, and then use the practical sessions to try the practical tutorials yourself by following the instructions and trying out the tasks.</p>
</div>
<div id="demonstration-part-i-length-15740" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Demonstration [Part I] (Length: 1:57:40)<a href="bayesian-hierarchical-regression-models.html#demonstration-part-i-length-15740" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/OkEcaOKpkGo" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/OkEcaOKpkGo">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="demonstration-part-ii-length-10148" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Demonstration [Part II] (Length: 1:01:48)<a href="bayesian-hierarchical-regression-models.html#demonstration-part-ii-length-10148" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/TLvrTTzufE0" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/TLvrTTzufE0">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="datasets-setting-up-the-work-directory-1" class="section level3 hasAnchor" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Datasets &amp; setting up the work directory<a href="bayesian-hierarchical-regression-models.html#datasets-setting-up-the-work-directory-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Go to your folder <strong>CPD-course</strong> and create a sub folder called “<strong>Day 4</strong>”. Here, we will store all our R &amp; Stan scripts and data files. Set your work directory to the <strong>Day 4</strong> folder.</p>
<p>For Windows, the code for setting the work directory will be:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="bayesian-hierarchical-regression-models.html#cb66-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/AccountName/Desktop/CPD-course/Day 4&quot;</span>)</span></code></pre></div>
<p>For MAC, the code for setting the work directory will be:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="bayesian-hierarchical-regression-models.html#cb67-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/Users/AccountName/Desktop/CPD-course/Day 4&quot;</span>)</span></code></pre></div>
<p>The main dataset for this practical:</p>
<ul>
<li><code>WHO-AFRO Cholera 2000-17.csv</code></li>
</ul>
<p>The dataset for the task:</p>
<ul>
<li><code>Pregnancies and hospital data.csv</code></li>
</ul>
<p>Let us load this dataset into memory:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="bayesian-hierarchical-regression-models.html#cb68-1" tabindex="-1"></a><span class="co"># load up the data</span></span>
<span id="cb68-2"><a href="bayesian-hierarchical-regression-models.html#cb68-2" tabindex="-1"></a>Maths_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;WHO-AFRO Cholera 2000-17.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="loading-packages-2" class="section level3 hasAnchor" number="5.1.6">
<h3><span class="header-section-number">5.1.6</span> Loading packages<a href="bayesian-hierarchical-regression-models.html#loading-packages-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to load the installed packages including <code>rstan</code> and <code>tidybayes</code>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="bayesian-hierarchical-regression-models.html#cb69-1" tabindex="-1"></a><span class="co"># load up packages</span></span>
<span id="cb69-2"><a href="bayesian-hierarchical-regression-models.html#cb69-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;rstan&#39;</span>)</span>
<span id="cb69-3"><a href="bayesian-hierarchical-regression-models.html#cb69-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;tidybayes&#39;</span>)</span>
<span id="cb69-4"><a href="bayesian-hierarchical-regression-models.html#cb69-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;tidyverse&#39;</span>)</span></code></pre></div>
<p>Configure Stan:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="bayesian-hierarchical-regression-models.html#cb70-1" tabindex="-1"></a><span class="co"># configure Stan</span></span>
<span id="cb70-2"><a href="bayesian-hierarchical-regression-models.html#cb70-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb70-3"><a href="bayesian-hierarchical-regression-models.html#cb70-3" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="data-preparation-and-set-up-for-bayesian-analysis-in-stan-1" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Data preparation and set-up for Bayesian analysis in Stan<a href="bayesian-hierarchical-regression-models.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are going to fit a 2-level Hierarchical regression model on a count outcome i.e., <strong>Cholera</strong> and to see the impact of the following risk factors: coverage of <strong>no basic water services</strong> and <strong>no sanitation services</strong>. The <code>WHO_AFRO_Cholera</code> object contains a total of 13 sub-Saharan African countries who are part of the World Health Organization, whereby each country has <strong>cholera</strong>, <strong>basic water</strong> and <strong>sanitation service</strong> information starting from 2000, and up to 2017, inclusive (i.e., 18 years worth of data). Other independent variables for the countries for each year includes <strong>GDP</strong>, <strong>Temperature</strong> and <strong>Rainfall</strong>.</p>
<p>Note that the yearly data are grouped within the 13 countries <code>country_id</code> or <code>country_name</code>. Within a country, the information has a unique reading captured by the <code>year_id</code>.</p>
<p>We want fit a <strong>2-level negative binomial Poisson regression model</strong> with <code>varying-intercept</code> and <code>varying-slopes</code> on the basic water and sanitation services variables. To explore:</p>
<ol style="list-style-type: decimal">
<li>Global relationships between the increased burden of limited water and basic sanitation services, and risk of cholera, across the WHO-AFRO.</li>
<li>Local relationships between the increased burden of limited water and basic sanitation services, and risk of cholera, within each country.</li>
</ol>
<p>To perform such 2-level hierarchical model, we need to prepare the dataset in RStudio accordingly by extracting the right pieces of information from the <code>WHO_AFRO_Cholera</code> data frame object to be passed to the <strong>data block</strong> in our Stan script.</p>
<p><strong>KEY INGREDIENTS</strong>:</p>
<ul>
<li><code>N</code>: total number of observations/rows in our dataset (234);</li>
<li><code>Country</code>: maximum number of groups formed in the dataset (13 countries);</li>
<li><code>CountryID</code>: this lists all the unique ID numbers for the group i.e., aligns country ID with the observations;</li>
<li><code>Cholera</code>: we want to extract this as a dependent variable and treat as an <code>int</code> because its <strong>counts</strong> measure;</li>
<li><code>Water</code>: we want to extract this as a primary independent variable and treat as an <code>real</code> since its a <strong>continuous</strong> measure;</li>
<li><code>Sanitation</code>: we want to extract the primary independent variable and treat as a <code>real</code> since its a <strong>continuous</strong> measure;</li>
<li><code>GDP</code>: we want to include this as an <strong>apriori</strong> independent variable and treat as an <code>real</code> since its a <strong>continuous</strong> measure;</li>
<li><code>Rainfall</code>: we want to include this as another <strong>apriori</strong> independent variable and treat as an <code>real</code> since its a <strong>continuous</strong> measure;</li>
<li><code>Temperature</code>: we want to include this as another <strong>apriori</strong> independent variable, just like the first two, and treat as an <code>real</code> since its a <strong>continuous</strong> measure;</li>
<li><code>Log_Population</code>: The <code>population</code> column has been log-transformed in the <code>list()</code>. This is going to be treated as an offset <code>real</code> measure;</li>
<li><code>phi</code>: Represent the dispersion in counts of cholera. We are going to assume that it is the same for all countries. We will assume their prior is from a beta distribution centred on around 0.2-0.3 (i.e., <strong>phi ~ beta(2, 5)</strong>).</li>
</ul>
<p>We can condense this information into <code>list()</code> object in line of code as our dataset for <strong>Stan</strong> to compile:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="bayesian-hierarchical-regression-models.html#cb71-1" tabindex="-1"></a><span class="co"># create dataset for Stan</span></span>
<span id="cb71-2"><a href="bayesian-hierarchical-regression-models.html#cb71-2" tabindex="-1"></a>stan.cholera.dataset <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb71-3"><a href="bayesian-hierarchical-regression-models.html#cb71-3" tabindex="-1"></a>    <span class="at">N=</span><span class="fu">nrow</span>(WHO_AFRO_Cholera), </span>
<span id="cb71-4"><a href="bayesian-hierarchical-regression-models.html#cb71-4" tabindex="-1"></a>    <span class="at">Country=</span><span class="fu">max</span>(<span class="fu">unique</span>(WHO_AFRO_Cholera<span class="sc">$</span>country_id)),</span>
<span id="cb71-5"><a href="bayesian-hierarchical-regression-models.html#cb71-5" tabindex="-1"></a>    <span class="at">CountryID=</span><span class="fu">as.integer</span>(WHO_AFRO_Cholera<span class="sc">$</span>country_id),</span>
<span id="cb71-6"><a href="bayesian-hierarchical-regression-models.html#cb71-6" tabindex="-1"></a>    <span class="at">Cholera=</span>WHO_AFRO_Cholera<span class="sc">$</span>cholera,</span>
<span id="cb71-7"><a href="bayesian-hierarchical-regression-models.html#cb71-7" tabindex="-1"></a>    <span class="at">Log_Population =</span> <span class="fu">log</span>(WHO_AFRO_Cholera<span class="sc">$</span>population),</span>
<span id="cb71-8"><a href="bayesian-hierarchical-regression-models.html#cb71-8" tabindex="-1"></a>    <span class="at">Water =</span> WHO_AFRO_Cholera<span class="sc">$</span>basic_water,</span>
<span id="cb71-9"><a href="bayesian-hierarchical-regression-models.html#cb71-9" tabindex="-1"></a>    <span class="at">Sanitation =</span> WHO_AFRO_Cholera<span class="sc">$</span>basic_sanitation,</span>
<span id="cb71-10"><a href="bayesian-hierarchical-regression-models.html#cb71-10" tabindex="-1"></a>    <span class="at">GDP =</span> WHO_AFRO_Cholera<span class="sc">$</span>gdp,</span>
<span id="cb71-11"><a href="bayesian-hierarchical-regression-models.html#cb71-11" tabindex="-1"></a>    <span class="at">Rainfall =</span> WHO_AFRO_Cholera<span class="sc">$</span>rainfall,</span>
<span id="cb71-12"><a href="bayesian-hierarchical-regression-models.html#cb71-12" tabindex="-1"></a>    <span class="at">Temperature =</span> WHO_AFRO_Cholera<span class="sc">$</span>temperature</span>
<span id="cb71-13"><a href="bayesian-hierarchical-regression-models.html#cb71-13" tabindex="-1"></a>)</span></code></pre></div>
<p>At this point, the dataset is now fully prepared and ready to go. Let’s create our <strong>Stan script</strong> for running a <strong>2-level negative binomial Poisson regression</strong> within a Bayesian framework.</p>
<div id="creating-a-script-to-run-a-2-level-multilevel-linear-regression-in-stan" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Creating a script to run a 2-level Multilevel linear regression in Stan<a href="bayesian-hierarchical-regression-models.html#creating-a-script-to-run-a-2-level-multilevel-linear-regression-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will need <code>data</code>, <code>parameters</code>, <code>transformed parameters</code> and <code>model</code> blocks for this analysis.</p>
<p><strong>FIRST STEP:</strong> In the <code>data</code> block, we can pass the key information from our list object <code>stan.cholera.dataset</code>.</p>
<pre class="text"><code>data {
  int&lt;lower=1&gt; N;                                  // Number of observations
  int&lt;lower=1&gt; Country;                            // Number of countries
  array[N] int&lt;lower=1, upper=Country&gt; CountryID;  // Country IDs 
  array[N] int&lt;lower=0&gt; Cholera;                   // Cholera cases
  array[N] real Water;                             // Water access variable
  array[N] real Sanitation;                        // Sanitation variable
  array[N] real GDP;                               // GDP variable
    array[N] real Rainfall;                          // Rainfall variable         
    array[N] real Temperature;                       // Temperature variable
  array[N] real Log_Population;                    // Logged Population variable used as offset
}</code></pre>
<p><strong>SECOND STEP:</strong> For the <strong>parameters</strong> block, here we will need to specify the name of the <strong>fixed effect</strong> of the regression model i.e., <code>gamma00</code>, <code>gamma01</code> and <code>gamma02</code>, which is the overall intercept, and the overall effect (coefficients) of <code>Water</code> and <code>Sanitation</code> on <code>Cholera</code>, respectively. These are operating on the level-1 part of the model. We want the intercept and latter coefficients vary across the countries at level-2; thus, we define <strong>country-specific random effects</strong> from them which is governed by some <strong>standard deviation</strong> i.e., their variation within countries.</p>
<p>Note that the coefficients <code>beta3</code>, <code>beta4</code> and <code>beta5</code> for <code>GDP</code>, <code>Rainfall</code> and <code>Temperature</code> are on level-1.</p>
<p>Lastly, we are defining <code>phi</code> for over-dispersed.</p>
<p>Here is the code:</p>
<pre class="text"><code>data {
  int&lt;lower=1&gt; N;                                  // Number of observations
  int&lt;lower=1&gt; Country;                            // Number of countries
  array[N] int&lt;lower=1, upper=Country&gt; CountryID;  // Country IDs 
  array[N] int&lt;lower=0&gt; Cholera;                   // Cholera cases
  array[N] real Water;                             // Water access variable
  array[N] real Sanitation;                        // Sanitation variable
  array[N] real GDP;                               // GDP variable
    array[N] real Rainfall;                          // Rainfall variable         
    array[N] real Temperature;                       // Temperature variable
  array[N] real Log_Population;                    // Logged Population variable used as offset
}

parameters {
  real gamma00;                                    // Overall intercept
  real gamma01;                                    // Overall effect of Water
  real gamma02;                                    // Overall effect of Sanitation
  real beta3;                                      // overall fixed effects relationship with GDP
    real beta4;                                      // overall fixed effects relationship with rainfall
    real beta5;                                      // overall fixed effects relationship with temperature
  array[Country] real random_intercept;            // Country-specific random intercepts
  array[Country] real random_slope_water;          // Country-specific random slopes for Water
  array[Country] real random_slope_sanitation;     // Country-specific random slopes for Sanitation
  real&lt;lower=0&gt; group_intercept_sd;                // SD of random intercepts
  real&lt;lower=0&gt; group_slope_water_sd;              // SD of random slopes for Water
  real&lt;lower=0&gt; group_slope_sanitation_sd;         // SD of random slopes for Sanitation
  real&lt;lower=0&gt; phi;                               // Use phi for dispersion
}</code></pre>
<p><strong>THIRD STEP:</strong> For the <strong>transformed parameters</strong> block, include the sub-equations for <code>beta00</code>, <code>beta01</code> and <code>beta02</code>, where we add the fixed effects and random effects:</p>
<pre class="text"><code>data {
  int&lt;lower=1&gt; N;                                  // Number of observations
  int&lt;lower=1&gt; Country;                            // Number of countries
  array[N] int&lt;lower=1, upper=Country&gt; CountryID;  // Country IDs 
  array[N] int&lt;lower=0&gt; Cholera;                   // Cholera cases
  array[N] real Water;                             // Water access variable
  array[N] real Sanitation;                        // Sanitation variable
  array[N] real GDP;                               // GDP variable
    array[N] real Rainfall;                          // Rainfall variable         
    array[N] real Temperature;                       // Temperature variable
  array[N] real Log_Population;                    // Logged Population variable used as offset
}

parameters {
  real gamma00;                                    // Overall intercept
  real gamma01;                                    // Overall effect of Water
  real gamma02;                                    // Overall effect of Sanitation
  real beta3;                                      // overall fixed effects relationship with GDP
    real beta4;                                      // overall fixed effects relationship with rainfall
    real beta5;                                      // overall fixed effects relationship with temperature
  array[Country] real random_intercept;            // Country-specific random intercepts
  array[Country] real random_slope_water;          // Country-specific random slopes for Water
  array[Country] real random_slope_sanitation;     // Country-specific random slopes for Sanitation
  real&lt;lower=0&gt; group_intercept_sd;                // SD of random intercepts
  real&lt;lower=0&gt; group_slope_water_sd;              // SD of random slopes for Water
  real&lt;lower=0&gt; group_slope_sanitation_sd;         // SD of random slopes for Sanitation
  real&lt;lower=0&gt; phi;                               // Use phi for dispersion
}
  
transformed parameters {
  array[Country] real beta00;
  array[Country] real beta01;
  array[Country] real beta02;

  for (j in 1:Country) {
    beta00[j] = gamma00 + random_intercept[j];           // Random intercept per country - overall risks of cholera varying by country
    beta01[j] = gamma01 + random_slope_water[j];         // Random slope for Water - overall risks cholera with `Water` varying by country
    beta02[j] = gamma02 + random_slope_sanitation[j];    // Random slope for Sanitation - overall risks cholera with `Sanitation` varying by country
  }
}</code></pre>
<p><strong>FOURTH STEP:</strong> We build our likelihood function and specify the priors for each parameter under the <strong>model</strong> block. This will contain our statistical model.</p>
<pre class="text"><code>data {
  int&lt;lower=1&gt; N;                                  // Number of observations
  int&lt;lower=1&gt; Country;                            // Number of countries
  array[N] int&lt;lower=1, upper=Country&gt; CountryID;  // Country IDs 
  array[N] int&lt;lower=0&gt; Cholera;                   // Cholera cases
  array[N] real Water;                             // Water access variable
  array[N] real Sanitation;                        // Sanitation variable
  array[N] real GDP;                               // GDP variable
    array[N] real Rainfall;                          // Rainfall variable         
    array[N] real Temperature;                       // Temperature variable
  array[N] real Log_Population;                    // Logged Population variable used as offset
}

parameters {
  real gamma00;                                    // Overall intercept
  real gamma01;                                    // Overall effect of Water
  real gamma02;                                    // Overall effect of Sanitation
  real beta3;                                      // overall fixed effects relationship with GDP
    real beta4;                                      // overall fixed effects relationship with rainfall
    real beta5;                                      // overall fixed effects relationship with temperature
  array[Country] real random_intercept;            // Country-specific random intercepts
  array[Country] real random_slope_water;          // Country-specific random slopes for Water
  array[Country] real random_slope_sanitation;     // Country-specific random slopes for Sanitation
  real&lt;lower=0&gt; group_intercept_sd;                // SD of random intercepts
  real&lt;lower=0&gt; group_slope_water_sd;              // SD of random slopes for Water
  real&lt;lower=0&gt; group_slope_sanitation_sd;         // SD of random slopes for Sanitation
  real&lt;lower=0&gt; phi;                               // Use phi for dispersion
}
  
transformed parameters {
  array[Country] real beta00;
  array[Country] real beta01;
  array[Country] real beta02;

  for (j in 1:Country) {
    beta00[j] = gamma00 + random_intercept[j];           // Random intercept per country - overall risks of cholera varying by country
    beta01[j] = gamma01 + random_slope_water[j];         // Random slope for Water - overall risks cholera with `Water` varying by country
    beta02[j] = gamma02 + random_slope_sanitation[j];    // Random slope for Sanitation - overall risks cholera with `Sanitation` varying by country
  }
}

model {
  // Priors for fixed effects
  gamma00 ~ normal(0, 1);
  gamma01 ~ normal(0, 1);
  gamma02 ~ normal(0, 1);
  beta3 ~ normal(0, 1);
  beta4 ~ normal(0, 1);
  beta5 ~ normal(0, 1);

  // Priors for random effects
  random_intercept ~ normal(0, group_intercept_sd);
  random_slope_water ~ normal(0, group_slope_water_sd);
  random_slope_sanitation ~ normal(0, group_slope_sanitation_sd);
  
  // Priors for standard deviations of random effects
  group_intercept_sd ~ cauchy(0, 0.5);
  group_slope_water_sd ~ cauchy(0, 0.5);
  group_slope_sanitation_sd ~ cauchy(0, 0.5);

  // Prior for overdispersion parameter
  phi ~ beta(2, 5);

  // Likelihood: Negative Binomial Poisson Regression
  for (i in 1:N) {
    Cholera[i] ~ neg_binomial_2_log(beta00[CountryID[i]] + beta01[CountryID[i]]*Water[i] + beta02[CountryID[i]]*Sanitation[i] + beta3*GDP[i] + beta4*Rainfall[i] + beta5*Temperature[i] + Log_Population[i], phi);
  }
}</code></pre>
<p><strong>FINAL STEP:</strong> We include <strong>generated quantities</strong> block to derive all results as relative risk ratios.</p>
<pre class="text"><code>data {
  int&lt;lower=1&gt; N;                                  // Number of observations
  int&lt;lower=1&gt; Country;                            // Number of countries
  array[N] int&lt;lower=1, upper=Country&gt; CountryID;  // Country IDs 
  array[N] int&lt;lower=0&gt; Cholera;                   // Cholera cases
  array[N] real Water;                             // Water access variable
  array[N] real Sanitation;                        // Sanitation variable
  array[N] real GDP;                               // GDP variable
  array[N] real Rainfall;                          // Rainfall variable
  array[N] real Temperature;                       // Temperature variable
  array[N] real Log_Population;                    // Logged Population variable used as offset
}

parameters {
  real gamma00;                                    // Overall intercept
  real gamma01;                                    // Overall effect of Water
  real gamma02;                                    // Overall effect of Sanitation
  real beta3;                                      // overall fixed effects relationship with GDP
    real beta4;                                      // overall fixed effects relationship with rainfall
    real beta5;                                      // overall fixed effects relationship with temperature
  array[Country] real random_intercept;            // Country-specific random intercepts
  array[Country] real random_slope_water;          // Country-specific random slopes for Water
  array[Country] real random_slope_sanitation;     // Country-specific random slopes for Sanitation
  real&lt;lower=0&gt; group_intercept_sd;                // SD of random intercepts
  real&lt;lower=0&gt; group_slope_water_sd;              // SD of random slopes for Water
  real&lt;lower=0&gt; group_slope_sanitation_sd;         // SD of random slopes for Sanitation
  real&lt;lower=0&gt; phi;                               // Use phi for dispersion
}
  
transformed parameters {
  array[Country] real beta00;
  array[Country] real beta01;
  array[Country] real beta02;

  for (j in 1:Country) {
    beta00[j] = gamma00 + random_intercept[j];           // Random intercept per country - overall risks of cholera varying by country
    beta01[j] = gamma01 + random_slope_water[j];         // Random slope for Water - overall risks cholera with `Water` varying by country
    beta02[j] = gamma02 + random_slope_sanitation[j];    // Random slope for Sanitation - overall risks cholera with `Sanitation` varying by country
  }
}

model {
  // Priors for fixed effects
  gamma00 ~ normal(0, 1);
  gamma01 ~ normal(0, 1);
  gamma02 ~ normal(0, 1);
  beta3 ~ normal(0, 1);
  beta4 ~ normal(0, 1);
  beta5 ~ normal(0, 1);

  // Priors for random effects
  random_intercept ~ normal(0, group_intercept_sd);
  random_slope_water ~ normal(0, group_slope_water_sd);
  random_slope_sanitation ~ normal(0, group_slope_sanitation_sd);
  
  // Priors for standard deviations of random effects
  group_intercept_sd ~ cauchy(0, 0.5);
  group_slope_water_sd ~ cauchy(0, 0.5);
  group_slope_sanitation_sd ~ cauchy(0, 0.5);

  // Prior for overdispersion parameter
  phi ~ beta(2, 5);

  // Likelihood: Negative Binomial Poisson Regression
  for (i in 1:N) {
    Cholera[i] ~ neg_binomial_2_log(beta00[CountryID[i]] + beta01[CountryID[i]]*Water[i] + beta02[CountryID[i]]*Sanitation[i] + beta3*GDP[i] + beta4*Rainfall[i] + beta5*Temperature[i] + Log_Population[i], phi);
  }
}

generated quantities {
    // report the coefficients as relative risk ratios
    real gamma00_RR;
  real gamma01_RR;
  real gamma02_RR;
    
  gamma00_RR = exp(gamma00);
  gamma01_RR = exp(gamma01);
  gamma02_RR = exp(gamma02);
    
  real beta3_RR;
  real beta4_RR;
  real beta5_RR;
    
  beta3_RR = exp(beta3);
  beta4_RR = exp(beta4);
  beta5_RR = exp(beta5);
        
    // report the varying slopes as relative risk ratios
  array[Country] real beta00_RR;
  array[Country] real beta01_RR;
  array[Country] real beta02_RR;
  
  beta00_RR = exp(beta00);
  beta01_RR = exp(beta01);
  beta02_RR = exp(beta02);
}
// end script</code></pre>
<div class="note">
<p>Let’s save the script as <code>Cholera Script.stan</code>. Now, we can compile and run it through RStudio to get our estimated coefficients.</p>
</div>
</div>
<div id="compiling-our-stan-code-for-hierarchical-modelling" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Compiling our Stan code for Hierarchical Modelling<a href="bayesian-hierarchical-regression-models.html#compiling-our-stan-code-for-hierarchical-modelling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, let us turn our attention to RStudio. Using the <code>stan()</code> to compile the save script to obtain the posterior estimation of the parameters in our hierarchical model:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="bayesian-hierarchical-regression-models.html#cb77-1" tabindex="-1"></a><span class="co"># Start the clock</span></span>
<span id="cb77-2"><a href="bayesian-hierarchical-regression-models.html#cb77-2" tabindex="-1"></a>ptm <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb77-3"><a href="bayesian-hierarchical-regression-models.html#cb77-3" tabindex="-1"></a><span class="co"># compile linear regression model for now</span></span>
<span id="cb77-4"><a href="bayesian-hierarchical-regression-models.html#cb77-4" tabindex="-1"></a>bayesian.hierarchical.model <span class="ot">=</span> <span class="fu">stan</span>(<span class="st">&quot;Cholera Script.stan&quot;</span>, <span class="at">data=</span>stan.dataset, <span class="at">iter=</span><span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">3</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-5"><a href="bayesian-hierarchical-regression-models.html#cb77-5" tabindex="-1"></a><span class="co"># Stop the clock</span></span>
<span id="cb77-6"><a href="bayesian-hierarchical-regression-models.html#cb77-6" tabindex="-1"></a><span class="fu">proc.time</span>() <span class="sc">-</span> ptm</span></code></pre></div>
<p><strong>Output summary table</strong></p>
<pre class="text"><code># print full table to avoid some rows from being omitted.
options(max.print = 100000)

# print full table to see all results
print(bayesian.hierarchical.model)

#PRINTED OUTPUT FROM CONSOLE

Inference for Stan model: anon_model.
3 chains, each with iter=3000; warmup=1500; thin=1; 
post-warmup draws per chain=1500, total post-warmup draws=4500.

                                mean se_mean     sd     2.5%      25%      50%      75%    97.5% n_eff Rhat
gamma00                        -0.52    0.02   0.95    -2.38    -1.16    -0.53     0.11     1.37  3059 1.00
gamma01                         0.59    0.01   0.30    -0.03     0.42     0.61     0.79     1.16  1780 1.00
gamma02                         0.39    0.01   0.42    -0.39     0.11     0.37     0.66     1.25  1841 1.00
beta3                           0.27    0.01   0.20    -0.13     0.14     0.27     0.41     0.65  1363 1.00
beta4                          -0.01    0.00   0.01    -0.02    -0.01    -0.01    -0.01     0.00  2878 1.00
beta5                          -0.30    0.00   0.04    -0.38    -0.33    -0.30    -0.27    -0.21  2767 1.00
random_intercept[1]            -0.04    0.01   0.34    -0.84    -0.15    -0.01     0.08     0.63  2975 1.00
random_intercept[2]            -0.02    0.01   0.34    -0.79    -0.14    -0.01     0.11     0.69  4060 1.00
random_intercept[3]             0.09    0.01   0.33    -0.47    -0.06     0.03     0.21     0.92  2012 1.00
random_intercept[4]             0.05    0.01   0.35    -0.62    -0.08     0.01     0.17     0.89  4091 1.00
random_intercept[5]             0.06    0.01   0.33    -0.57    -0.08     0.02     0.17     0.83  2752 1.00
random_intercept[6]            -0.13    0.01   0.38    -1.13    -0.25    -0.05     0.05     0.47   984 1.00
random_intercept[7]            -0.02    0.00   0.26    -0.59    -0.13    -0.01     0.09     0.56  4029 1.00
random_intercept[8]            -0.07    0.01   0.28    -0.75    -0.19    -0.03     0.06     0.47  2355 1.00
random_intercept[9]            -0.06    0.01   0.36    -0.95    -0.17    -0.02     0.09     0.61  3042 1.00
random_intercept[10]            0.02    0.01   0.34    -0.68    -0.11     0.00     0.13     0.77  3193 1.00
random_intercept[11]            0.14    0.01   0.37    -0.43    -0.04     0.05     0.25     1.14  1049 1.00
random_intercept[12]            0.01    0.00   0.25    -0.50    -0.10     0.00     0.11     0.59  2753 1.00
random_intercept[13]           -0.11    0.01   0.35    -1.02    -0.23    -0.04     0.06     0.47  1403 1.00
random_slope_water[1]           0.20    0.01   0.56    -0.80    -0.09     0.11     0.45     1.58  2275 1.00
random_slope_water[2]           0.10    0.01   0.57    -1.05    -0.18     0.06     0.37     1.38  2779 1.00
random_slope_water[3]           0.14    0.01   0.46    -0.78    -0.09     0.09     0.38     1.16  2596 1.00
random_slope_water[4]          -0.31    0.01   0.44    -1.33    -0.55    -0.23    -0.01     0.42  1034 1.00
random_slope_water[5]          -0.07    0.01   0.42    -0.91    -0.30    -0.06     0.12     0.87  1882 1.00
random_slope_water[6]          -0.06    0.01   0.60    -1.47    -0.31    -0.01     0.23     1.15  4630 1.00
random_slope_water[7]           0.47    0.03   0.64    -0.44     0.02     0.31     0.79     2.11   605 1.00
random_slope_water[8]          -0.12    0.01   0.43    -1.06    -0.34    -0.07     0.11     0.71  2222 1.00
random_slope_water[9]          -0.23    0.02   0.63    -1.84    -0.51    -0.10     0.12     0.85  1610 1.00
random_slope_water[10]         -0.56    0.03   0.74    -2.39    -0.95    -0.35    -0.03     0.42   569 1.00
random_slope_water[11]          0.17    0.01   0.40    -0.62    -0.06     0.12     0.39     1.02  2011 1.00
random_slope_water[12]         -0.22    0.01   0.54    -1.46    -0.48    -0.12     0.08     0.73  1628 1.00
random_slope_water[13]          0.65    0.03   0.78    -0.29     0.08     0.41     1.06     2.59   516 1.00
random_slope_sanitation[1]      0.22    0.01   0.66    -1.05    -0.22     0.19     0.64     1.57  2253 1.00
random_slope_sanitation[2]      0.31    0.01   0.50    -0.72    -0.01     0.32     0.64     1.24  2156 1.00
random_slope_sanitation[3]      0.47    0.02   1.38    -2.12    -0.40     0.40     1.28     3.35  3419 1.00
random_slope_sanitation[4]      0.21    0.02   0.73    -1.23    -0.28     0.21     0.67     1.66  1610 1.00
random_slope_sanitation[5]      2.03    0.03   1.04     0.11     1.31     2.00     2.70     4.17  1612 1.00
random_slope_sanitation[6]      1.45    0.02   0.78    -0.06     0.94     1.46     1.96     2.96  1491 1.00
random_slope_sanitation[7]      1.13    0.03   1.33    -1.09     0.19     1.02     1.92     4.06  1521 1.00
random_slope_sanitation[8]      0.10    0.01   0.84    -1.47    -0.45     0.09     0.64     1.80  3218 1.00
random_slope_sanitation[9]     -1.12    0.02   0.78    -2.74    -1.62    -1.11    -0.60     0.36  1669 1.00
random_slope_sanitation[10]    -1.29    0.02   0.74    -2.75    -1.77    -1.29    -0.79     0.12  2215 1.00
random_slope_sanitation[11]    -1.29    0.02   0.70    -2.73    -1.75    -1.28    -0.80     0.02  1707 1.00
random_slope_sanitation[12]    -0.99    0.02   0.69    -2.34    -1.46    -0.98    -0.52     0.34  1670 1.00
random_slope_sanitation[13]    -0.17    0.01   0.64    -1.42    -0.58    -0.18     0.24     1.08  1936 1.00
group_intercept_sd              0.28    0.02   0.24     0.02     0.10     0.22     0.40     0.88   179 1.00
group_slope_water_sd            0.57    0.02   0.39     0.06     0.27     0.50     0.78     1.48   313 1.01
group_slope_sanitation_sd       1.33    0.01   0.47     0.56     1.01     1.27     1.58     2.37  1202 1.00
phi                             0.46    0.00   0.04     0.39     0.43     0.46     0.49     0.54  4832 1.00
beta00[1]                      -0.56    0.02   1.02    -2.59    -1.23    -0.57     0.11     1.44  3256 1.00
beta00[2]                      -0.54    0.02   1.00    -2.51    -1.19    -0.55     0.13     1.46  3161 1.00
beta00[3]                      -0.43    0.02   1.02    -2.45    -1.11    -0.43     0.25     1.61  2975 1.00
beta00[4]                      -0.47    0.02   1.03    -2.46    -1.15    -0.48     0.20     1.61  3083 1.00
beta00[5]                      -0.46    0.02   1.01    -2.47    -1.14    -0.47     0.21     1.58  2919 1.00
beta00[6]                      -0.65    0.02   1.03    -2.75    -1.33    -0.64     0.02     1.36  2771 1.00
beta00[7]                      -0.54    0.02   0.97    -2.45    -1.19    -0.53     0.10     1.41  3073 1.00
beta00[8]                      -0.59    0.02   0.99    -2.55    -1.25    -0.59     0.07     1.35  3069 1.00
beta00[9]                      -0.58    0.02   1.03    -2.64    -1.25    -0.58     0.11     1.43  3066 1.00
beta00[10]                     -0.50    0.02   1.02    -2.54    -1.19    -0.51     0.16     1.52  3219 1.00
beta00[11]                     -0.39    0.02   1.03    -2.37    -1.08    -0.40     0.29     1.66  2592 1.00
beta00[12]                     -0.51    0.02   0.98    -2.41    -1.16    -0.52     0.13     1.41  3030 1.00
beta00[13]                     -0.63    0.02   1.02    -2.65    -1.30    -0.62     0.04     1.36  2886 1.00
beta01[1]                       0.80    0.01   0.58    -0.33     0.46     0.76     1.10     2.14  2975 1.00
beta01[2]                       0.70    0.01   0.61    -0.53     0.38     0.69     1.01     2.02  3754 1.00
beta01[3]                       0.74    0.01   0.45    -0.20     0.48     0.74     1.01     1.64  2684 1.00
beta01[4]                       0.29    0.02   0.49    -0.82    -0.02     0.35     0.63     1.11   874 1.00
beta01[5]                       0.52    0.01   0.37    -0.25     0.30     0.54     0.76     1.27  3294 1.00
beta01[6]                       0.53    0.01   0.67    -1.03     0.22     0.59     0.91     1.80  3007 1.00
beta01[7]                       1.07    0.02   0.61     0.09     0.64     0.97     1.40     2.54   754 1.00
beta01[8]                       0.48    0.01   0.43    -0.47     0.22     0.51     0.76     1.27  2051 1.00
beta01[9]                       0.37    0.02   0.70    -1.36     0.02     0.49     0.80     1.55  1284 1.00
beta01[10]                      0.04    0.03   0.83    -2.02    -0.39     0.24     0.62     1.22   564 1.00
beta01[11]                      0.76    0.01   0.39    -0.01     0.52     0.75     1.00     1.54  2399 1.00
beta01[12]                      0.37    0.02   0.58    -0.99     0.07     0.45     0.74     1.37  1178 1.00
beta01[13]                      1.25    0.03   0.77     0.16     0.70     1.07     1.68     3.06   600 1.00
beta02[1]                       0.61    0.01   0.58    -0.43     0.21     0.57     0.96     1.86  2941 1.00
beta02[2]                       0.70    0.00   0.27     0.14     0.53     0.70     0.87     1.21  4444 1.00
beta02[3]                       0.86    0.03   1.45    -1.77    -0.07     0.78     1.71     3.90  3171 1.00
beta02[4]                       0.60    0.02   0.64    -0.65     0.16     0.60     1.02     1.88  1665 1.00
beta02[5]                       2.42    0.03   1.07     0.37     1.68     2.42     3.13     4.54  1687 1.00
beta02[6]                       1.84    0.02   0.74     0.34     1.36     1.86     2.34     3.22  1423 1.00
beta02[7]                       1.52    0.03   1.39    -0.84     0.53     1.39     2.38     4.57  1819 1.00
beta02[8]                       0.49    0.01   0.81    -1.07    -0.05     0.48     1.00     2.13  3592 1.00
beta02[9]                      -0.74    0.02   0.68    -2.04    -1.19    -0.76    -0.30     0.66  1798 1.00
beta02[10]                     -0.90    0.02   0.68    -2.19    -1.36    -0.92    -0.46     0.50  2050 1.00
beta02[11]                     -0.91    0.01   0.58    -2.07    -1.28    -0.90    -0.52     0.20  1512 1.00
beta02[12]                     -0.60    0.02   0.62    -1.80    -1.01    -0.64    -0.23     0.75  1577 1.00
beta02[13]                      0.22    0.01   0.53    -0.75    -0.13     0.20     0.55     1.32  2464 1.00
gamma00_RR                      0.94    0.02   1.18     0.09     0.31     0.59     1.11     3.94  2838 1.00
gamma01_RR                      1.89    0.01   0.56     0.97     1.52     1.84     2.20     3.18  2057 1.00
gamma02_RR                      1.62    0.02   0.75     0.68     1.11     1.45     1.94     3.50  1786 1.00
beta3_RR                        1.33    0.01   0.27     0.87     1.15     1.31     1.50     1.92  1474 1.00
beta4_RR                        0.99    0.00   0.01     0.98     0.99     0.99     0.99     1.00  2879 1.00
beta5_RR                        0.74    0.00   0.03     0.68     0.72     0.74     0.76     0.81  2764 1.00
beta00_RR[1]                    0.96    0.02   1.32     0.08     0.29     0.56     1.12     4.22  3061 1.00
beta00_RR[2]                    0.96    0.02   1.25     0.08     0.30     0.58     1.13     4.30  2994 1.00
beta00_RR[3]                    1.10    0.03   1.49     0.09     0.33     0.65     1.29     4.99  2653 1.00
beta00_RR[4]                    1.10    0.04   1.86     0.09     0.32     0.62     1.22     4.98  2758 1.00
beta00_RR[5]                    1.08    0.03   1.63     0.08     0.32     0.63     1.23     4.85  2893 1.00
beta00_RR[6]                    0.88    0.02   1.23     0.06     0.27     0.53     1.02     3.89  2897 1.00
beta00_RR[7]                    0.94    0.02   1.23     0.09     0.30     0.59     1.11     4.09  2777 1.00
beta00_RR[8]                    0.90    0.02   1.17     0.08     0.29     0.55     1.08     3.86  2696 1.00
beta00_RR[9]                    0.94    0.02   1.28     0.07     0.29     0.56     1.12     4.18  3033 1.00
beta00_RR[10]                   1.03    0.03   1.49     0.08     0.30     0.60     1.17     4.59  2829 1.00
beta00_RR[11]                   1.19    0.04   1.84     0.09     0.34     0.67     1.34     5.27  2390 1.00
beta00_RR[12]                   0.97    0.02   1.26     0.09     0.31     0.60     1.14     4.10  2782 1.00
beta00_RR[13]                   0.91    0.03   1.54     0.07     0.27     0.54     1.04     3.91  2895 1.00
beta01_RR[1]                    2.71    0.05   2.45     0.72     1.59     2.13     3.00     8.46  2095 1.00
beta01_RR[2]                    2.45    0.04   2.07     0.59     1.46     1.99     2.76     7.51  2634 1.00
beta01_RR[3]                    2.33    0.03   1.33     0.82     1.61     2.09     2.73     5.14  2365 1.00
beta01_RR[4]                    1.49    0.02   0.68     0.44     0.98     1.42     1.87     3.05  1119 1.00
beta01_RR[5]                    1.81    0.01   0.73     0.78     1.35     1.71     2.14     3.56  2784 1.00
beta01_RR[6]                    2.13    0.03   1.84     0.36     1.24     1.80     2.49     6.07  3057 1.00
beta01_RR[7]                    3.65    0.11   3.44     1.10     1.90     2.63     4.06    12.66   970 1.00
beta01_RR[8]                    1.77    0.02   0.78     0.63     1.24     1.66     2.13     3.56  2439 1.00
beta01_RR[9]                    1.78    0.03   1.21     0.26     1.02     1.63     2.22     4.73  2272 1.00
beta01_RR[10]                   1.35    0.03   0.89     0.13     0.67     1.27     1.87     3.40   881 1.00
beta01_RR[11]                   2.31    0.02   1.00     0.99     1.67     2.12     2.72     4.66  2519 1.00
beta01_RR[12]                   1.69    0.02   0.99     0.37     1.07     1.58     2.09     3.95  2288 1.00
beta01_RR[13]                   5.07    0.22   6.82     1.17     2.01     2.90     5.38    21.35   992 1.00
beta02_RR[1]                    2.22    0.04   1.90     0.65     1.24     1.77     2.62     6.43  2363 1.00
beta02_RR[2]                    2.08    0.01   0.58     1.15     1.69     2.02     2.39     3.36  4284 1.00
beta02_RR[3]                   15.51    3.97 231.58     0.17     0.93     2.18     5.53    49.53  3406 1.00
beta02_RR[4]                    2.24    0.04   1.68     0.52     1.17     1.81     2.77     6.53  2282 1.00
beta02_RR[5]                   20.08    0.58  29.58     1.45     5.36    11.23    22.88    94.06  2588 1.00
beta02_RR[6]                    8.16    0.15   6.58     1.40     3.89     6.44    10.33    25.02  2041 1.00
beta02_RR[7]                   15.62    1.15  60.65     0.43     1.69     4.02    10.75    96.23  2794 1.00
beta02_RR[8]                    2.35    0.06   3.46     0.34     0.95     1.61     2.73     8.45  3218 1.00
beta02_RR[9]                    0.61    0.01   0.49     0.13     0.30     0.47     0.74     1.93  1537 1.00
beta02_RR[10]                   0.52    0.01   0.42     0.11     0.26     0.40     0.63     1.66  1570 1.00
beta02_RR[11]                   0.48    0.01   0.30     0.13     0.28     0.41     0.59     1.22  1224 1.00
beta02_RR[12]                   0.67    0.02   0.56     0.17     0.37     0.53     0.80     2.11  1305 1.00
beta02_RR[13]                   1.45    0.02   1.04     0.47     0.88     1.22     1.73     3.73  2128 1.00
lp__                        -2050.22    1.22  14.88 -2076.40 -2060.84 -2051.37 -2040.26 -2019.30   149 1.00

Samples were drawn using NUTS(diag_e) at Thu Jun 12 05:52:03 2025.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
<p>You can examine the traceplot of divergence if necessary:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="bayesian-hierarchical-regression-models.html#cb79-1" tabindex="-1"></a><span class="co"># print traceplot for the global coefficients</span></span>
<span id="cb79-2"><a href="bayesian-hierarchical-regression-models.html#cb79-2" tabindex="-1"></a><span class="fu">traceplot</span>(bayesian.hierarchical.model, </span>
<span id="cb79-3"><a href="bayesian-hierarchical-regression-models.html#cb79-3" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;gamma00_RR&quot;</span>, <span class="st">&quot;gamma01_RR&quot;</span>, <span class="st">&quot;gamma02_RR&quot;</span>, <span class="st">&quot;beta3_RR&quot;</span>, <span class="st">&quot;beta4_RR&quot;</span>, <span class="st">&quot;beta5_RR&quot;</span>,</span>
<span id="cb79-4"><a href="bayesian-hierarchical-regression-models.html#cb79-4" tabindex="-1"></a>        <span class="st">&quot;group_intercept_sd&quot;</span>, <span class="st">&quot;group_slope_water_sd&quot;</span>, <span class="st">&quot;group_slope_sanitation_sd&quot;</span>, <span class="st">&quot;phi&quot;</span>))</span>
<span id="cb79-5"><a href="bayesian-hierarchical-regression-models.html#cb79-5" tabindex="-1"></a></span>
<span id="cb79-6"><a href="bayesian-hierarchical-regression-models.html#cb79-6" tabindex="-1"></a><span class="co"># print traceplot for the varying intercept and varying coefficients results</span></span>
<span id="cb79-7"><a href="bayesian-hierarchical-regression-models.html#cb79-7" tabindex="-1"></a><span class="fu">traceplot</span>(bayesian.hierarchical.model, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;beta00_RR&quot;</span>, <span class="st">&quot;beta01_RR&quot;</span>, <span class="st">&quot;beta02_RR&quot;</span>))</span></code></pre></div>
<p>Dealing with results from <strong>Stan</strong> can be very challenging. Let us show you how to extract the desired results. We will first report the overall relative risks and group variations:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="bayesian-hierarchical-regression-models.html#cb80-1" tabindex="-1"></a><span class="co"># print table to reports the relative risk ratios for Cholera</span></span>
<span id="cb80-2"><a href="bayesian-hierarchical-regression-models.html#cb80-2" tabindex="-1"></a><span class="fu">print</span>(bayesian.hierarchical.model, </span>
<span id="cb80-3"><a href="bayesian-hierarchical-regression-models.html#cb80-3" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), </span>
<span id="cb80-4"><a href="bayesian-hierarchical-regression-models.html#cb80-4" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;gamma00_RR&quot;</span>, <span class="st">&quot;gamma01_RR&quot;</span>, <span class="st">&quot;gamma02_RR&quot;</span>, <span class="st">&quot;beta3_RR&quot;</span>, <span class="st">&quot;beta4_RR&quot;</span>, <span class="st">&quot;beta5_RR&quot;</span>,</span>
<span id="cb80-5"><a href="bayesian-hierarchical-regression-models.html#cb80-5" tabindex="-1"></a>        <span class="st">&quot;group_intercept_sd&quot;</span>, <span class="st">&quot;group_slope_water_sd&quot;</span>, <span class="st">&quot;group_slope_sanitation_sd&quot;</span>))</span>
<span id="cb80-6"><a href="bayesian-hierarchical-regression-models.html#cb80-6" tabindex="-1"></a></span>
<span id="cb80-7"><a href="bayesian-hierarchical-regression-models.html#cb80-7" tabindex="-1"></a><span class="co"># PRINTED OUTPUT</span></span>
<span id="cb80-8"><a href="bayesian-hierarchical-regression-models.html#cb80-8" tabindex="-1"></a></span>
<span id="cb80-9"><a href="bayesian-hierarchical-regression-models.html#cb80-9" tabindex="-1"></a>Inference <span class="cf">for</span> Stan model<span class="sc">:</span> anon_model.</span>
<span id="cb80-10"><a href="bayesian-hierarchical-regression-models.html#cb80-10" tabindex="-1"></a><span class="dv">3</span> chains, each with iter<span class="ot">=</span><span class="dv">3000</span>; warmup<span class="ot">=</span><span class="dv">1500</span>; thin<span class="ot">=</span><span class="dv">1</span>; </span>
<span id="cb80-11"><a href="bayesian-hierarchical-regression-models.html#cb80-11" tabindex="-1"></a>post<span class="sc">-</span>warmup draws per chain<span class="ot">=</span><span class="dv">1500</span>, total post<span class="sc">-</span>warmup draws<span class="ot">=</span><span class="fl">4500.</span></span>
<span id="cb80-12"><a href="bayesian-hierarchical-regression-models.html#cb80-12" tabindex="-1"></a></span>
<span id="cb80-13"><a href="bayesian-hierarchical-regression-models.html#cb80-13" tabindex="-1"></a>                          mean se_mean   sd <span class="fl">2.5</span><span class="sc">% 97.5%</span> n_eff Rhat</span>
<span id="cb80-14"><a href="bayesian-hierarchical-regression-models.html#cb80-14" tabindex="-1"></a>gamma00_RR                <span class="fl">0.94</span>    <span class="fl">0.02</span> <span class="fl">1.18</span> <span class="fl">0.09</span>  <span class="fl">3.94</span>  <span class="dv">2838</span> <span class="fl">1.00</span></span>
<span id="cb80-15"><a href="bayesian-hierarchical-regression-models.html#cb80-15" tabindex="-1"></a>gamma01_RR                <span class="fl">1.89</span>    <span class="fl">0.01</span> <span class="fl">0.56</span> <span class="fl">0.97</span>  <span class="fl">3.18</span>  <span class="dv">2057</span> <span class="fl">1.00</span></span>
<span id="cb80-16"><a href="bayesian-hierarchical-regression-models.html#cb80-16" tabindex="-1"></a>gamma02_RR                <span class="fl">1.62</span>    <span class="fl">0.02</span> <span class="fl">0.75</span> <span class="fl">0.68</span>  <span class="fl">3.50</span>  <span class="dv">1786</span> <span class="fl">1.00</span></span>
<span id="cb80-17"><a href="bayesian-hierarchical-regression-models.html#cb80-17" tabindex="-1"></a>beta3_RR                  <span class="fl">1.33</span>    <span class="fl">0.01</span> <span class="fl">0.27</span> <span class="fl">0.87</span>  <span class="fl">1.92</span>  <span class="dv">1474</span> <span class="fl">1.00</span></span>
<span id="cb80-18"><a href="bayesian-hierarchical-regression-models.html#cb80-18" tabindex="-1"></a>beta4_RR                  <span class="fl">0.99</span>    <span class="fl">0.00</span> <span class="fl">0.01</span> <span class="fl">0.98</span>  <span class="fl">1.00</span>  <span class="dv">2879</span> <span class="fl">1.00</span></span>
<span id="cb80-19"><a href="bayesian-hierarchical-regression-models.html#cb80-19" tabindex="-1"></a>beta5_RR                  <span class="fl">0.74</span>    <span class="fl">0.00</span> <span class="fl">0.03</span> <span class="fl">0.68</span>  <span class="fl">0.81</span>  <span class="dv">2764</span> <span class="fl">1.00</span></span>
<span id="cb80-20"><a href="bayesian-hierarchical-regression-models.html#cb80-20" tabindex="-1"></a>group_intercept_sd        <span class="fl">0.28</span>    <span class="fl">0.02</span> <span class="fl">0.24</span> <span class="fl">0.02</span>  <span class="fl">0.88</span>   <span class="dv">179</span> <span class="fl">1.00</span></span>
<span id="cb80-21"><a href="bayesian-hierarchical-regression-models.html#cb80-21" tabindex="-1"></a>group_slope_water_sd      <span class="fl">0.57</span>    <span class="fl">0.02</span> <span class="fl">0.39</span> <span class="fl">0.06</span>  <span class="fl">1.48</span>   <span class="dv">313</span> <span class="fl">1.01</span></span>
<span id="cb80-22"><a href="bayesian-hierarchical-regression-models.html#cb80-22" tabindex="-1"></a>group_slope_sanitation_sd <span class="fl">1.33</span>    <span class="fl">0.01</span> <span class="fl">0.47</span> <span class="fl">0.56</span>  <span class="fl">2.37</span>  <span class="dv">1202</span> <span class="fl">1.00</span></span>
<span id="cb80-23"><a href="bayesian-hierarchical-regression-models.html#cb80-23" tabindex="-1"></a></span>
<span id="cb80-24"><a href="bayesian-hierarchical-regression-models.html#cb80-24" tabindex="-1"></a>Samples were drawn using <span class="fu">NUTS</span>(diag_e) at Thu Jun <span class="dv">12</span> <span class="dv">05</span><span class="sc">:</span><span class="dv">52</span><span class="sc">:</span><span class="dv">03</span> <span class="fl">2025.</span></span>
<span id="cb80-25"><a href="bayesian-hierarchical-regression-models.html#cb80-25" tabindex="-1"></a>For each parameter, n_eff is a crude measure of effective sample size,</span>
<span id="cb80-26"><a href="bayesian-hierarchical-regression-models.html#cb80-26" tabindex="-1"></a>and Rhat is the potential scale reduction factor on split <span class="fu">chains</span> (at </span>
<span id="cb80-27"><a href="bayesian-hierarchical-regression-models.html#cb80-27" tabindex="-1"></a>convergence, <span class="at">Rhat=</span><span class="dv">1</span>).</span></code></pre></div>
<p>Here is the <strong>interpretation</strong>:</p>
<ul>
<li><code>gamma00</code> is the overall baseline risk of cholera in sub-Saharan Africa. It is <strong>0.94 (95% CrI from 0.09 to 3.94)</strong> times lower than usual in the population.</li>
<li><code>gamma01</code> is the overall risk of cholera associated with coverage <strong>without basic water services</strong> in sub-Saharan Africa. The risk of cholera is <strong>1.89 (95% CrI: 0.97 to 3.18)</strong> times higher when coverage without such service gets higher.</li>
<li><code>gamma02</code> is the overall risk of cholera associated with coverage <strong>without basic sanitation services</strong> in sub-Saharan Africa. The risk of cholera is <strong>1.62 (95% CrI: 0.68 to 3.50)</strong> times higher when coverage without such service gets higher.</li>
<li><code>group_intercept_sd</code>: The standard deviation is <strong>0.28</strong> - this is the random intercepts across countries, which suggests that WHO-AFRO countries have somewhat low variability in their baseline cholera rates. This can be interpreted as countries don’t differ drastically in baseline cholera risk (this can be eyeballed from the non-exponentiated values from <code>beta00[1]</code>, <code>beta00[2]</code> to <code>beta00[13]</code>).</li>
<li><code>group_slope_water_sd</code>: The standard deviation is <strong>0.57</strong> - this is the random slope for the water service, which suggests that its effect on cholera risk somewhat varies considerably across the countries and not stable unlike the baseline risk (0.57 vs. 0.28)(- this variation can be eyeballed from the exponentiated values of <code>beta01_RR[1]</code> to <code>beta01_RR[13]</code>).</li>
<li><code>group_slope_santitation_sd</code>: The standard deviation is <strong>1.33</strong> - this is the random slope for the sanitation services, which suggests that its effect on cholera risk substantially varies across the countries, more so than the intercept and water (- this variation can be eyeballed from the exponentiated values of <code>beta02_RR[1]</code> to <code>beta02_RR[13]</code>).</li>
</ul>
<p>This portion of the code computes the exceedance probabilities the overall results above:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="bayesian-hierarchical-regression-models.html#cb81-1" tabindex="-1"></a><span class="co"># This portion of the code computes the exceedance probabilities for the intercept &amp; each beta coefficient</span></span>
<span id="cb81-2"><a href="bayesian-hierarchical-regression-models.html#cb81-2" tabindex="-1"></a>threshold.gamma00_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-3"><a href="bayesian-hierarchical-regression-models.html#cb81-3" tabindex="-1"></a>gamma00_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(gamma00_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="bayesian-hierarchical-regression-models.html#cb81-4" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">gamma00_RR=</span><span class="fu">threshold.gamma00_RR</span>(gamma00_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="bayesian-hierarchical-regression-models.html#cb81-5" tabindex="-1"></a>    <span class="fu">pull</span>(gamma00_RR)</span>
<span id="cb81-6"><a href="bayesian-hierarchical-regression-models.html#cb81-6" tabindex="-1"></a></span>
<span id="cb81-7"><a href="bayesian-hierarchical-regression-models.html#cb81-7" tabindex="-1"></a>threshold.gamma01_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-8"><a href="bayesian-hierarchical-regression-models.html#cb81-8" tabindex="-1"></a>gamma01_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(gamma01_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="bayesian-hierarchical-regression-models.html#cb81-9" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">gamma01_RR=</span><span class="fu">threshold.gamma01_RR</span>(gamma01_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-10"><a href="bayesian-hierarchical-regression-models.html#cb81-10" tabindex="-1"></a>    <span class="fu">pull</span>(gamma01_RR)</span>
<span id="cb81-11"><a href="bayesian-hierarchical-regression-models.html#cb81-11" tabindex="-1"></a></span>
<span id="cb81-12"><a href="bayesian-hierarchical-regression-models.html#cb81-12" tabindex="-1"></a>threshold.gamma02_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-13"><a href="bayesian-hierarchical-regression-models.html#cb81-13" tabindex="-1"></a>gamma02_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(gamma02_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-14"><a href="bayesian-hierarchical-regression-models.html#cb81-14" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">gamma02_RR=</span><span class="fu">threshold.gamma02_RR</span>(gamma02_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-15"><a href="bayesian-hierarchical-regression-models.html#cb81-15" tabindex="-1"></a>    <span class="fu">pull</span>(gamma02_RR)</span>
<span id="cb81-16"><a href="bayesian-hierarchical-regression-models.html#cb81-16" tabindex="-1"></a></span>
<span id="cb81-17"><a href="bayesian-hierarchical-regression-models.html#cb81-17" tabindex="-1"></a>threshold.beta3_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-18"><a href="bayesian-hierarchical-regression-models.html#cb81-18" tabindex="-1"></a>beta3_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(beta3_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-19"><a href="bayesian-hierarchical-regression-models.html#cb81-19" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">beta3_RR=</span><span class="fu">threshold.beta3_RR</span> (beta3_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-20"><a href="bayesian-hierarchical-regression-models.html#cb81-20" tabindex="-1"></a>    <span class="fu">pull</span>(beta3_RR)</span>
<span id="cb81-21"><a href="bayesian-hierarchical-regression-models.html#cb81-21" tabindex="-1"></a></span>
<span id="cb81-22"><a href="bayesian-hierarchical-regression-models.html#cb81-22" tabindex="-1"></a>threshold.beta4_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-23"><a href="bayesian-hierarchical-regression-models.html#cb81-23" tabindex="-1"></a>beta4_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(beta4_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-24"><a href="bayesian-hierarchical-regression-models.html#cb81-24" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">beta4_RR=</span><span class="fu">threshold.beta4_RR</span>(beta4_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-25"><a href="bayesian-hierarchical-regression-models.html#cb81-25" tabindex="-1"></a>    <span class="fu">pull</span>(beta4_RR)</span>
<span id="cb81-26"><a href="bayesian-hierarchical-regression-models.html#cb81-26" tabindex="-1"></a></span>
<span id="cb81-27"><a href="bayesian-hierarchical-regression-models.html#cb81-27" tabindex="-1"></a>threshold.beta5_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb81-28"><a href="bayesian-hierarchical-regression-models.html#cb81-28" tabindex="-1"></a>beta5_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(beta5_RR) <span class="sc">%&gt;%</span> </span>
<span id="cb81-29"><a href="bayesian-hierarchical-regression-models.html#cb81-29" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">beta5_RR=</span><span class="fu">threshold.beta5_RR</span>(beta5_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb81-30"><a href="bayesian-hierarchical-regression-models.html#cb81-30" tabindex="-1"></a>    <span class="fu">pull</span>(beta5_RR)</span>
<span id="cb81-31"><a href="bayesian-hierarchical-regression-models.html#cb81-31" tabindex="-1"></a></span>
<span id="cb81-32"><a href="bayesian-hierarchical-regression-models.html#cb81-32" tabindex="-1"></a><span class="co"># report exceedance probability results</span></span>
<span id="cb81-33"><a href="bayesian-hierarchical-regression-models.html#cb81-33" tabindex="-1"></a>gamma00_RR.exc.probs</span>
<span id="cb81-34"><a href="bayesian-hierarchical-regression-models.html#cb81-34" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.296175</span></span>
<span id="cb81-35"><a href="bayesian-hierarchical-regression-models.html#cb81-35" tabindex="-1"></a>gamma01_RR.exc.probs</span>
<span id="cb81-36"><a href="bayesian-hierarchical-regression-models.html#cb81-36" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.963475</span></span>
<span id="cb81-37"><a href="bayesian-hierarchical-regression-models.html#cb81-37" tabindex="-1"></a>gamma02_RR.exc.probs</span>
<span id="cb81-38"><a href="bayesian-hierarchical-regression-models.html#cb81-38" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.84035</span></span>
<span id="cb81-39"><a href="bayesian-hierarchical-regression-models.html#cb81-39" tabindex="-1"></a>beta3_RR.exc.probs</span>
<span id="cb81-40"><a href="bayesian-hierarchical-regression-models.html#cb81-40" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9022667</span></span>
<span id="cb81-41"><a href="bayesian-hierarchical-regression-models.html#cb81-41" tabindex="-1"></a>beta4_RR.exc.probs</span>
<span id="cb81-42"><a href="bayesian-hierarchical-regression-models.html#cb81-42" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.06706667</span></span>
<span id="cb81-43"><a href="bayesian-hierarchical-regression-models.html#cb81-43" tabindex="-1"></a>beta5_RR.exc.probs</span>
<span id="cb81-44"><a href="bayesian-hierarchical-regression-models.html#cb81-44" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span></code></pre></div>
<p>We have presented the overall results. What about those that vary across countries? Let put everything into a table - here, its just a matter of writing codes to extracting the results and presenting them in a manner to be use in a paper or assignment:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="bayesian-hierarchical-regression-models.html#cb82-1" tabindex="-1"></a><span class="co"># Create a vector of names for the results - for overall, and for those that are country-specific</span></span>
<span id="cb82-2"><a href="bayesian-hierarchical-regression-models.html#cb82-2" tabindex="-1"></a><span class="co"># note: any country with &#39;_w&#39; is specific for water service</span></span>
<span id="cb82-3"><a href="bayesian-hierarchical-regression-models.html#cb82-3" tabindex="-1"></a><span class="co"># note: any country with &#39;_s&#39; is specific for sanitation service</span></span>
<span id="cb82-4"><a href="bayesian-hierarchical-regression-models.html#cb82-4" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;baseline&quot;</span>, <span class="st">&quot;water&quot;</span>, <span class="st">&quot;sanitation&quot;</span>, <span class="st">&quot;gdp&quot;</span>, <span class="st">&quot;rainfall&quot;</span>, <span class="st">&quot;temperature&quot;</span>, <span class="st">&quot;ben_w&quot;</span>, <span class="st">&quot;bur_w&quot;</span>, <span class="st">&quot;drc_w&quot;</span>, <span class="st">&quot;gha_w&quot;</span>, <span class="st">&quot;ivc_w&quot;</span>, <span class="st">&quot;ken_w&quot;</span>,</span>
<span id="cb82-5"><a href="bayesian-hierarchical-regression-models.html#cb82-5" tabindex="-1"></a>    <span class="st">&quot;mal_w&quot;</span>, <span class="st">&quot;moz_w&quot;</span>, <span class="st">&quot;ner_w&quot;</span>, <span class="st">&quot;nir_w&quot;</span>, <span class="st">&quot;som_w&quot;</span>, <span class="st">&quot;tan_w&quot;</span>, <span class="st">&quot;tog_w&quot;</span>, <span class="st">&quot;ben_s&quot;</span>, <span class="st">&quot;bur_s&quot;</span>, <span class="st">&quot;drc_s&quot;</span>, <span class="st">&quot;gha_s&quot;</span>, <span class="st">&quot;ivc_s&quot;</span>, <span class="st">&quot;ken_s&quot;</span>,</span>
<span id="cb82-6"><a href="bayesian-hierarchical-regression-models.html#cb82-6" tabindex="-1"></a>    <span class="st">&quot;mal_s&quot;</span>, <span class="st">&quot;moz_s&quot;</span>, <span class="st">&quot;ner_s&quot;</span>, <span class="st">&quot;nir_s&quot;</span>, <span class="st">&quot;som_s&quot;</span>, <span class="st">&quot;tan_s&quot;</span>, <span class="st">&quot;tog_s&quot;</span>)</span></code></pre></div>
<p>Create a data frame with the desired results:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="bayesian-hierarchical-regression-models.html#cb83-1" tabindex="-1"></a><span class="co"># export selected output as a data frame into &#39;result&#39; object</span></span>
<span id="cb83-2"><a href="bayesian-hierarchical-regression-models.html#cb83-2" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(bayesian.hierarchical.model, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;gamma00_RR&quot;</span> , <span class="st">&quot;gamma01_RR&quot;</span>, <span class="st">&quot;gamma02_RR&quot;</span>, <span class="st">&quot;beta3_RR&quot;</span>, <span class="st">&quot;beta4_RR&quot;</span>, <span class="st">&quot;beta5_RR&quot;</span>, <span class="st">&quot;beta01_RR&quot;</span>, <span class="st">&quot;beta02_RR&quot;</span>))<span class="sc">$</span>summary)</span></code></pre></div>
<p>Align the <code>names</code> to the results in the <code>results</code> object:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="bayesian-hierarchical-regression-models.html#cb84-1" tabindex="-1"></a>results<span class="sc">$</span>variables <span class="ot">&lt;-</span> names</span>
<span id="cb84-2"><a href="bayesian-hierarchical-regression-models.html#cb84-2" tabindex="-1"></a><span class="fu">row.names</span>(results) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results)</span></code></pre></div>
<p>Now, we are cleaning the table up, with appropriate renaming and re-positioning of columns, and rounding the estimates down to 2 decimal places.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="bayesian-hierarchical-regression-models.html#cb85-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> results[,<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)]</span>
<span id="cb85-2"><a href="bayesian-hierarchical-regression-models.html#cb85-2" tabindex="-1"></a>results<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>mean, <span class="dv">2</span>)</span>
<span id="cb85-3"><a href="bayesian-hierarchical-regression-models.html#cb85-3" tabindex="-1"></a><span class="fu">colnames</span>(results)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;RelativeRisks&quot;</span></span>
<span id="cb85-4"><a href="bayesian-hierarchical-regression-models.html#cb85-4" tabindex="-1"></a><span class="fu">colnames</span>(results)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;lower95&quot;</span></span>
<span id="cb85-5"><a href="bayesian-hierarchical-regression-models.html#cb85-5" tabindex="-1"></a><span class="fu">colnames</span>(results)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;upper95&quot;</span></span>
<span id="cb85-6"><a href="bayesian-hierarchical-regression-models.html#cb85-6" tabindex="-1"></a><span class="fu">colnames</span>(results)[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;ess&quot;</span></span>
<span id="cb85-7"><a href="bayesian-hierarchical-regression-models.html#cb85-7" tabindex="-1"></a><span class="fu">colnames</span>(results)[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;rhat&quot;</span></span>
<span id="cb85-8"><a href="bayesian-hierarchical-regression-models.html#cb85-8" tabindex="-1"></a>results<span class="sc">$</span>lower95<span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>lower95, <span class="dv">2</span>)</span>
<span id="cb85-9"><a href="bayesian-hierarchical-regression-models.html#cb85-9" tabindex="-1"></a>results<span class="sc">$</span>upper95 <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>upper95, <span class="dv">2</span>)</span>
<span id="cb85-10"><a href="bayesian-hierarchical-regression-models.html#cb85-10" tabindex="-1"></a>results<span class="sc">$</span>ess <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>ess, <span class="dv">0</span>)</span>
<span id="cb85-11"><a href="bayesian-hierarchical-regression-models.html#cb85-11" tabindex="-1"></a>results<span class="sc">$</span>rhat <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>rhat, <span class="dv">2</span>)</span></code></pre></div>
<p>We are going to stitch the exceedance probabilities into this table. Note, we have not calculated the exceedance probabilities for the varying slopes! This portion of the code computes that for you:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="bayesian-hierarchical-regression-models.html#cb86-1" tabindex="-1"></a><span class="co"># This portion of the code computes the exceedance probabilities for the varying slope coefficients for each country</span></span>
<span id="cb86-2"><a href="bayesian-hierarchical-regression-models.html#cb86-2" tabindex="-1"></a>threshold.beta01_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb86-3"><a href="bayesian-hierarchical-regression-models.html#cb86-3" tabindex="-1"></a>beta01_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(beta01_RR[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="bayesian-hierarchical-regression-models.html#cb86-4" tabindex="-1"></a>    <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">beta01_RR=</span><span class="fu">threshold.beta01_RR</span>(beta01_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="bayesian-hierarchical-regression-models.html#cb86-5" tabindex="-1"></a>    <span class="fu">pull</span>(beta01_RR)</span>
<span id="cb86-6"><a href="bayesian-hierarchical-regression-models.html#cb86-6" tabindex="-1"></a></span>
<span id="cb86-7"><a href="bayesian-hierarchical-regression-models.html#cb86-7" tabindex="-1"></a>threshold.beta02_RR <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x <span class="sc">&gt;</span> <span class="fl">1.00</span>)}</span>
<span id="cb86-8"><a href="bayesian-hierarchical-regression-models.html#cb86-8" tabindex="-1"></a>beta02_RR.exc.probs <span class="ot">&lt;-</span> bayesian.hierarchical.model <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(beta02_RR[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb86-9"><a href="bayesian-hierarchical-regression-models.html#cb86-9" tabindex="-1"></a>    <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">beta02_RR=</span><span class="fu">threshold.beta02_RR</span>(beta02_RR)) <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="bayesian-hierarchical-regression-models.html#cb86-10" tabindex="-1"></a>    <span class="fu">pull</span>(beta02_RR)</span>
<span id="cb86-11"><a href="bayesian-hierarchical-regression-models.html#cb86-11" tabindex="-1"></a></span>
<span id="cb86-12"><a href="bayesian-hierarchical-regression-models.html#cb86-12" tabindex="-1"></a>beta01_RR.exc.probs</span>
<span id="cb86-13"><a href="bayesian-hierarchical-regression-models.html#cb86-13" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9328583</span> <span class="fl">0.9021333</span> <span class="fl">0.9555667</span> <span class="fl">0.7321000</span> <span class="fl">0.9221833</span> <span class="fl">0.8309167</span> <span class="fl">0.9854167</span> <span class="fl">0.8771083</span> <span class="fl">0.7624833</span> <span class="fl">0.6029917</span> <span class="fl">0.9712000</span> <span class="fl">0.7726417</span> <span class="fl">0.9893000</span></span>
<span id="cb86-14"><a href="bayesian-hierarchical-regression-models.html#cb86-14" tabindex="-1"></a></span>
<span id="cb86-15"><a href="bayesian-hierarchical-regression-models.html#cb86-15" tabindex="-1"></a>beta02_RR.exc.probs</span>
<span id="cb86-16"><a href="bayesian-hierarchical-regression-models.html#cb86-16" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.8711167</span> <span class="fl">0.9891167</span> <span class="fl">0.7319250</span> <span class="fl">0.8213667</span> <span class="fl">0.9921333</span> <span class="fl">0.9918500</span> <span class="fl">0.8769833</span> <span class="fl">0.7330500</span> <span class="fl">0.1448750</span> <span class="fl">0.1002167</span> <span class="fl">0.0541000</span> <span class="fl">0.1655333</span> <span class="fl">0.6480667</span></span></code></pre></div>
<p>We create the table output with final results</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="bayesian-hierarchical-regression-models.html#cb87-1" tabindex="-1"></a>table <span class="ot">&lt;-</span> results</span>
<span id="cb87-2"><a href="bayesian-hierarchical-regression-models.html#cb87-2" tabindex="-1"></a>table<span class="sc">$</span>RR_95CrI <span class="ot">&lt;-</span> <span class="fu">paste</span>(table<span class="sc">$</span>RelativeRisks, <span class="st">&quot; (95% CrI: &quot;</span>, table<span class="sc">$</span>lower95, <span class="st">&quot; to &quot;</span>, table<span class="sc">$</span>upper95, <span class="st">&quot;)&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb87-3"><a href="bayesian-hierarchical-regression-models.html#cb87-3" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(gamma00_RR.exc.probs, gamma01_RR.exc.probs, gamma02_RR.exc.probs, beta3_RR.exc.probs, beta4_RR.exc.probs, beta5_RR.exc.probs, beta01_RR.exc.probs, beta02_RR.exc.probs)</span>
<span id="cb87-4"><a href="bayesian-hierarchical-regression-models.html#cb87-4" tabindex="-1"></a>table<span class="sc">$</span>ExceedProbs <span class="ot">&lt;-</span> <span class="fu">round</span>(probs, <span class="dv">2</span>)</span>
<span id="cb87-5"><a href="bayesian-hierarchical-regression-models.html#cb87-5" tabindex="-1"></a>table<span class="sc">$</span>ESS_Rhat <span class="ot">&lt;-</span> <span class="fu">paste</span>(table<span class="sc">$</span>ess, <span class="st">&quot; (Rhat = &quot;</span>, table<span class="sc">$</span>rhat, <span class="st">&quot; &lt; 1.05)&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb87-6"><a href="bayesian-hierarchical-regression-models.html#cb87-6" tabindex="-1"></a>finaltable <span class="ot">&lt;-</span> table[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>)]</span></code></pre></div>
<p>We have the full results in the <code>finaltable</code> object.</p>
<p>Let us use an example for <code>gha_w</code> which refers to the estimate random slope for limited water services and it effect on cholera risk in Ghana. The risk in relation to this variable is <strong>1.49 (95% CrI: 0.42 to 3.11)</strong> times higher. Such chance of risk being greater than 1 in relation to this variable is <strong>0.73 (73%)</strong>. This result; however, is not significant.</p>
</div>
</div>
<div id="task" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Task<a href="bayesian-hierarchical-regression-models.html#task" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Try your hand on this problem in Stan</strong>: Build a random intercept logit model using data on 1060 births to 501 mothers. The outcome of interest is whether the <code>birth</code> was delivered in a hospital or elsewhere. The predictors include the log of income <code>loginc</code>, the <code>distance</code> to the nearest hospital distance, and two indicators of mothers’s education: <code>dropout</code> for less than high school and college for college <code>graduate</code>, so high school or some college is the reference cell.</p>
<p>Have ago at building this model.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-generalised-linear-models-glms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-spatial-modelling-for-areal-data-in-stan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": false
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/UCLPG-MSC-SGDS/UCL-SODA-CPD-RStan/edit/main/intro_to_Bayesian_Hierarchicals.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
