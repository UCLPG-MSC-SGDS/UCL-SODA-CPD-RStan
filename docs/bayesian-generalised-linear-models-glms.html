<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Bayesian Generalised Linear Models (GLMs) | Introduction to Bayesian Inference and Modelling (June 2025)</title>
  <meta name="description" content="Introduction to Bayesian Inference and Modelling" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Bayesian Generalised Linear Models (GLMs) | Introduction to Bayesian Inference and Modelling (June 2025)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Introduction to Bayesian Inference and Modelling" />
  <meta name="github-repo" content="UCLPG-MSC-SGDS/UCL-SODA-CPD-RStan" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Bayesian Generalised Linear Models (GLMs) | Introduction to Bayesian Inference and Modelling (June 2025)" />
  
  <meta name="twitter:description" content="Introduction to Bayesian Inference and Modelling" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-bayesian-inference.html"/>
<link rel="next" href="bayesian-hierarchical-regression-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/social-data/home/social-data-institute"><img src="images/general/SODA_logo_only.jpg">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#timetable-schedule-location"><i class="fa fa-check"></i>Timetable, Schedule &amp; Location</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-contact-details"><i class="fa fa-check"></i>My Contact Details</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html"><i class="fa fa-check"></i>Reading List</a>
<ul>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-1-introduction-to-probability-distributions"><i class="fa fa-check"></i>Day 1: Introduction to Probability Distributions</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-2-introduction-to-bayesian-inference"><i class="fa fa-check"></i>Day 2: Introduction to Bayesian Inference</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-3-bayesian-generalised-linear-models-glms"><i class="fa fa-check"></i>Day 3: Bayesian Generalised Linear Models (GLMs)</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-4-bayesian-hierarchical-regression-models"><i class="fa fa-check"></i>Day 4: Bayesian Hierarchical Regression Models</a></li>
<li class="chapter" data-level="" data-path="reading-list.html"><a href="reading-list.html#day-5-bayesian-spatial-modelling-for-areal-data-in-stan"><i class="fa fa-check"></i>Day 5: Bayesian Spatial Modelling for Areal Data in Stan</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html"><i class="fa fa-check"></i><b>1</b> Installation of R, RStudio &amp; Stan</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#what-is-stan"><i class="fa fa-check"></i><b>1.1</b> What is Stan?</a></li>
<li class="chapter" data-level="1.2" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-of-r-rstudio"><i class="fa fa-check"></i><b>1.2</b> Installation of R &amp; RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-process-for-mac-users"><i class="fa fa-check"></i><b>1.2.1</b> Installation process for MAC users</a></li>
<li class="chapter" data-level="1.2.2" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-process-for-windows-users"><i class="fa fa-check"></i><b>1.2.2</b> Installation process for Windows users</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="installation-of-r-rstudio-stan.html"><a href="installation-of-r-rstudio-stan.html#installation-of-rstan-or-stan-other-important-r-packages"><i class="fa fa-check"></i><b>1.3</b> Installation of <code>rstan</code> (or Stan) &amp; other important r-packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html"><i class="fa fa-check"></i><b>2</b> Introduction to Stan Programming</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#lectures-length-15555-minutes"><i class="fa fa-check"></i><b>2.1.1</b> Lectures (Length: 1:55:55 minutes)</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#learning-outcomes"><i class="fa fa-check"></i><b>2.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.1.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#demonstration-length-10838-minutes"><i class="fa fa-check"></i><b>2.1.3</b> Demonstration (Length: 1:08:38 minutes)</a></li>
<li class="chapter" data-level="2.1.4" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#setting-up-the-work-directory"><i class="fa fa-check"></i><b>2.1.4</b> Setting up the work directory</a></li>
<li class="chapter" data-level="2.1.5" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#loading-packages"><i class="fa fa-check"></i><b>2.1.5</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#about-stan-programming"><i class="fa fa-check"></i><b>2.2</b> About Stan Programming</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-i-opening-a-stan-script-in-rstudio"><i class="fa fa-check"></i><b>2.2.1</b> Basic building blocks I: Opening a Stan Script in RStudio</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-ii-structure-of-a-stan-script"><i class="fa fa-check"></i><b>2.2.2</b> Basic building blocks II: Structure of a Stan script</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-iii-data-types-and-constraint-declarations"><i class="fa fa-check"></i><b>2.2.3</b> Basic building blocks III: Data types and constraint declarations</a></li>
<li class="chapter" data-level="2.2.4" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-iv-developing-our-model"><i class="fa fa-check"></i><b>2.2.4</b> Basic building blocks IV: Developing our model</a></li>
<li class="chapter" data-level="2.2.5" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-v-compiling-stan-code-in-rstudio"><i class="fa fa-check"></i><b>2.2.5</b> Basic building blocks V: Compiling Stan code in RStudio</a></li>
<li class="chapter" data-level="2.2.6" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#basic-building-blocks-vi-extract-posterior-samples-interpretation"><i class="fa fa-check"></i><b>2.2.6</b> Basic building blocks VI: Extract posterior samples &amp; interpretation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#tasks"><i class="fa fa-check"></i><b>2.3</b> Tasks</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#task-1---simulating-and-estimating-body-mass-index-bmi"><i class="fa fa-check"></i><b>2.3.1</b> Task 1 - Simulating and Estimating Body Mass Index (BMI)</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-stan-programming.html"><a href="introduction-to-stan-programming.html#task-2---low-level-arsenic-poisoning-in-cornwall-uk"><i class="fa fa-check"></i><b>2.3.2</b> Task 2 - Low-level arsenic poisoning in Cornwall, UK</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html"><i class="fa fa-check"></i><b>3</b> Introduction to Bayesian Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#lectures-length-11522-minutes"><i class="fa fa-check"></i><b>3.1.1</b> Lectures (Length: 1:15:22 minutes)</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#learning-outcomes-1"><i class="fa fa-check"></i><b>3.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#demonstration-length-12254-minutes"><i class="fa fa-check"></i><b>3.1.3</b> Demonstration (Length: 1:22:54 minutes)</a></li>
<li class="chapter" data-level="3.1.4" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#setting-up-the-work-directory-1"><i class="fa fa-check"></i><b>3.1.4</b> Setting up the work directory</a></li>
<li class="chapter" data-level="3.1.5" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#loading-packages-1"><i class="fa fa-check"></i><b>3.1.5</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#input-data-process-model-and-assumptions-for-priors"><i class="fa fa-check"></i><b>3.2</b> Input: Data, Process Model and Assumptions for Priors</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#compiling-stan-code-in-rstudio"><i class="fa fa-check"></i><b>3.3</b> Compiling Stan code in RStudio</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#tasks-1"><i class="fa fa-check"></i><b>3.4</b> Tasks</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-bayesian-inference.html"><a href="introduction-to-bayesian-inference.html#task-1---aedes-borne-infestation-in-recife-052023"><i class="fa fa-check"></i><b>3.4.1</b> Task 1 - Aedes-borne infestation in Recife 05/2023</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html"><i class="fa fa-check"></i><b>4</b> Bayesian Generalised Linear Models (GLMs)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#lectures-length-10416-minutes"><i class="fa fa-check"></i><b>4.1.1</b> Lectures (Length: 1:04:16 minutes)</a></li>
<li class="chapter" data-level="4.1.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#learning-outcomes-2"><i class="fa fa-check"></i><b>4.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.1.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#demonstration-part-i-length-15936-minutes"><i class="fa fa-check"></i><b>4.1.3</b> Demonstration [Part I] (Length: 1:59:36 minutes)</a></li>
<li class="chapter" data-level="4.1.4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#demonstration-part-ii-length-11338-minutes"><i class="fa fa-check"></i><b>4.1.4</b> Demonstration [Part II] (Length: 1:13:38 minutes)</a></li>
<li class="chapter" data-level="4.1.5" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#datasets-setting-up-the-work-directory"><i class="fa fa-check"></i><b>4.1.5</b> Datasets &amp; setting up the work directory</a></li>
<li class="chapter" data-level="4.1.6" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#loading-and-installing-packages"><i class="fa fa-check"></i><b>4.1.6</b> Loading and installing packages</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#poisson-regression-modelling"><i class="fa fa-check"></i><b>4.2</b> Poisson Regression Modelling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#selecting-the-appropriate-poisson-model"><i class="fa fa-check"></i><b>4.2.1</b> Selecting the appropriate Poisson model</a></li>
<li class="chapter" data-level="4.2.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan"><i class="fa fa-check"></i><b>4.2.2</b> Data preparation and set-up for Bayesian analysis in Stan</a></li>
<li class="chapter" data-level="4.2.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#creating-a-script-to-run-a-negative-binomial-poisson-regression-in-stan"><i class="fa fa-check"></i><b>4.2.3</b> Creating a script to run a Negative Binomial Poisson regression in Stan</a></li>
<li class="chapter" data-level="4.2.4" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#compiling-our-stan-code-in-rstudio-and-results"><i class="fa fa-check"></i><b>4.2.4</b> Compiling our Stan code in RStudio and Results</a></li>
<li class="chapter" data-level="4.2.5" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#model-with-categorical-variables"><i class="fa fa-check"></i><b>4.2.5</b> Model with categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#tasks-2"><i class="fa fa-check"></i><b>4.3</b> Tasks</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#task-1---obesity-and-fastfoods-in-london"><i class="fa fa-check"></i><b>4.3.1</b> Task 1 - Obesity and Fastfoods in London</a></li>
<li class="chapter" data-level="4.3.2" data-path="bayesian-generalised-linear-models-glms.html"><a href="bayesian-generalised-linear-models-glms.html#task-2---factors-affecting-house-prices-in-london-2015"><i class="fa fa-check"></i><b>4.3.2</b> Task 2 - Factors affecting house prices in London (2015)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html"><i class="fa fa-check"></i><b>5</b> Bayesian Hierarchical Regression Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#lectures-tbc"><i class="fa fa-check"></i><b>5.1.1</b> Lectures (TBC)</a></li>
<li class="chapter" data-level="5.1.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#learning-outcomes-3"><i class="fa fa-check"></i><b>5.1.2</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.1.3" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#demonstration-tbc"><i class="fa fa-check"></i><b>5.1.3</b> Demonstration (TBC)</a></li>
<li class="chapter" data-level="5.1.4" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#datasets-setting-up-the-work-directory-1"><i class="fa fa-check"></i><b>5.1.4</b> Datasets &amp; setting up the work directory</a></li>
<li class="chapter" data-level="5.1.5" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#loading-packages-2"><i class="fa fa-check"></i><b>5.1.5</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan-1"><i class="fa fa-check"></i><b>5.2</b> Data preparation and set-up for Bayesian analysis in Stan</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#creating-a-script-to-run-a-2-level-multilevel-linear-regression-in-stan"><i class="fa fa-check"></i><b>5.2.1</b> Creating a script to run a 2-level Multilevel linear regression in Stan</a></li>
<li class="chapter" data-level="5.2.2" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#compiling-our-stan-code-for-hierarchical-modelling"><i class="fa fa-check"></i><b>5.2.2</b> Compiling our Stan code for Hierarchical Modelling</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="bayesian-hierarchical-regression-models.html"><a href="bayesian-hierarchical-regression-models.html#task"><i class="fa fa-check"></i><b>5.3</b> Task</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Inference and Modelling (June 2025)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-generalised-linear-models-glms" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Bayesian Generalised Linear Models (GLMs)<a href="bayesian-generalised-linear-models-glms.html#bayesian-generalised-linear-models-glms" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="bayesian-generalised-linear-models-glms.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="lectures-length-10416-minutes" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Lectures (Length: 1:04:16 minutes)<a href="bayesian-generalised-linear-models-glms.html#lectures-length-10416-minutes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/1_JbtNNB6_0" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/1_JbtNNB6_0">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="learning-outcomes-2" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Learning outcomes<a href="bayesian-generalised-linear-models-glms.html#learning-outcomes-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Today’s session aims to formally introduce you to <strong>Stan</strong> programming for <strong>Bayesian regression models</strong>. By the end of this session, you should be able to perform the following:</p>
<ul>
<li>Select the appropriate <strong>likelihood function</strong> specification for the <strong>Bayesian</strong> regression model i.e., <strong>normal</strong>, <strong>binomial</strong> or <strong>Poisson</strong> to model either <strong>continuous</strong>, <strong>binary</strong>, or <strong>count</strong> outcomes respectively;</li>
<li>How to fully develop <strong>Stan</strong> code for such regression models with the appropriate <strong>prior (i.e., uninformative, weak or informative) specification</strong> for various parameters;</li>
<li>How to interpret the various types of coefficients including <strong>Odds Ratios (OR)</strong> and <strong>Risk Ratios (RR)</strong>;</li>
<li>Computing <strong>exceedance probabilities</strong>;</li>
<li>Model validation</li>
</ul>
<p>You can follow the live walkthrough demonstration, and then use the practical sessions to try the practical tutorials yourself by following the instructions and trying out the tasks.</p>
</div>
<div id="demonstration-part-i-length-15936-minutes" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Demonstration [Part I] (Length: 1:59:36 minutes)<a href="bayesian-generalised-linear-models-glms.html#demonstration-part-i-length-15936-minutes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/WRIFeQ_pgfk" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/WRIFeQ_pgfk">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="demonstration-part-ii-length-11338-minutes" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Demonstration [Part II] (Length: 1:13:38 minutes)<a href="bayesian-generalised-linear-models-glms.html#demonstration-part-ii-length-11338-minutes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/Xd1o12psU78" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/Xd1o12psU78">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="datasets-setting-up-the-work-directory" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Datasets &amp; setting up the work directory<a href="bayesian-generalised-linear-models-glms.html#datasets-setting-up-the-work-directory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Go to your folder <strong>CPD-course</strong> and create a sub folder called “<strong>Day 3</strong>”. Here, we will store all our R &amp; Stan scripts as well as the dataset for this session. Set your work directory to <strong>Day 3’s</strong> folder.</p>
<p>For Windows, the code for setting the work directory will be:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="bayesian-generalised-linear-models-glms.html#cb40-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/AccountName/Desktop/CPD-course/Day 3&quot;</span>)</span></code></pre></div>
<p>For MAC, the code for setting the work directory will be:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="bayesian-generalised-linear-models-glms.html#cb41-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/Users/AccountName/Desktop/CPD-course/Day 3&quot;</span>)</span></code></pre></div>
<p>The dataset for this practical:</p>
<ul>
<li><code>Street Burglary Data in Nigeria.csv</code></li>
</ul>
<p>The datasets for the task at the end of the practical:</p>
<ul>
<li><code>London LSOA 2015 data.csv</code></li>
<li><code>Obesity and Fastfoods in MSOAs data.csv</code></li>
</ul>
<p>Let us start with the crime data titled: <code>Street Burglary Data in Nigeria.csv</code></p>
<div class="note">
<p><strong>Context about the dataset:</strong> Conventional analyses of crime, based on European research models, are often poorly suited to assessing the specific dimensions of criminality in Africa or elsewhere in the Global South. The data used in today’s practical is an anonymised resampled excerpt from the <a href="https://www.urbantransformations.ox.ac.uk/project/development-frontiers-in-crime-livelihoods-and-urban-poverty-in-nigeria-fclp/"><strong>Development Frontiers in Crime, Livelihoods and Urban Poverty in Nigeria (FCLP)</strong></a> project that aimed to provide an alternative framework for understanding the specific drivers of criminality in a West African urban context. This research project used a mixed-methods approach for combining statistical modeling, geovisualisation and ethnography, and attempted to situate insecurity and crime against a broader backdrop of rapid urban growth, seasonal migration, youth unemployment and informality. The study typically provided researchers both in Nigeria and internationally a richer and more nuanced evidence base on the particular dynamics of crime from an African perspective resulting a number of publications: <a href="https://www.sciencedirect.com/science/article/abs/pii/S0143622818311949"><strong>[1]</strong></a>, <a href="https://link.springer.com/article/10.1007/s10940-019-09448-3"><strong>[2]</strong></a> and <a href="https://academic.oup.com/edited-volume/34642/chapter-abstract/295177150?redirectedFrom=fulltext&amp;login=false"><strong>[3]</strong></a>.</p>
<p>We will reproduce some of the analysis using a Bayesian regression model.</p>
</div>
</div>
<div id="loading-and-installing-packages" class="section level3 hasAnchor" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> Loading and installing packages<a href="bayesian-generalised-linear-models-glms.html#loading-and-installing-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will need to load the following packages:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="bayesian-generalised-linear-models-glms.html#cb42-1" tabindex="-1"></a><span class="co"># Load the packages with library()</span></span>
<span id="cb42-2"><a href="bayesian-generalised-linear-models-glms.html#cb42-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;rstan&#39;</span>)</span>
<span id="cb42-3"><a href="bayesian-generalised-linear-models-glms.html#cb42-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;loo&quot;</span>)</span>
<span id="cb42-4"><a href="bayesian-generalised-linear-models-glms.html#cb42-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;MASS&quot;</span>)</span></code></pre></div>
<p>For the best experience with <code>rstan</code>, we highly recommend using this code to set the cores:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="bayesian-generalised-linear-models-glms.html#cb43-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb43-2"><a href="bayesian-generalised-linear-models-glms.html#cb43-2" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="poisson-regression-modelling" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Poisson Regression Modelling<a href="bayesian-generalised-linear-models-glms.html#poisson-regression-modelling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are going to fit a Poisson-type model on an outcome that contains discrete counts of households reporting to have been victims of burglary. These are counts of burglary events aggregated to street segments. Let us load the data into RStudio and call the object <code>burglaryDataset</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="bayesian-generalised-linear-models-glms.html#cb44-1" tabindex="-1"></a><span class="co"># Set your own directory using setwd() function</span></span>
<span id="cb44-2"><a href="bayesian-generalised-linear-models-glms.html#cb44-2" tabindex="-1"></a><span class="co"># Load data into RStudio using read.csv(). The spreadsheet is stored in the object called &#39;burglaryData&#39;</span></span>
<span id="cb44-3"><a href="bayesian-generalised-linear-models-glms.html#cb44-3" tabindex="-1"></a>burglaryDataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Street Burglary Data in Nigeria.csv&quot;</span>)</span>
<span id="cb44-4"><a href="bayesian-generalised-linear-models-glms.html#cb44-4" tabindex="-1"></a><span class="fu">names</span>(burglaryDataset)</span></code></pre></div>
<div id="selecting-the-appropriate-poisson-model" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Selecting the appropriate Poisson model<a href="bayesian-generalised-linear-models-glms.html#selecting-the-appropriate-poisson-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are three different types of Poisson models:</p>
<ul>
<li>Standard Poisson regression</li>
<li>Negative Binomial Poisson regression</li>
<li>Zero-Inflated Poisson regression</li>
</ul>
<p>The implementation of one of these models are highly dependent on how the frequency distribution of the count response variable are displayed. If it resembles a normal curve - then use the standard Poisson version. Otherwise, use the <strong>Negative Binomial Poisson regression</strong> if there is any evidence of over-dispersion. When there’s an inflation of zero counts in the dataset, you will have to use the <strong>Zero-Inflated model</strong> to account for this problem.</p>
<p><img src="images/general/Plot_test_poisson.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Let’s check the frequency distribution of the outcome variable <code>Burglary</code> which corresponds to the number of reported instances a property on a street was burgled. You can simply use a histogram to examine its distribution:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="bayesian-generalised-linear-models-glms.html#cb45-1" tabindex="-1"></a><span class="co"># see lowest count</span></span>
<span id="cb45-2"><a href="bayesian-generalised-linear-models-glms.html#cb45-2" tabindex="-1"></a><span class="fu">min</span>(burglaryDataset<span class="sc">$</span>burglary)</span>
<span id="cb45-3"><a href="bayesian-generalised-linear-models-glms.html#cb45-3" tabindex="-1"></a><span class="co"># see highest count </span></span>
<span id="cb45-4"><a href="bayesian-generalised-linear-models-glms.html#cb45-4" tabindex="-1"></a><span class="fu">max</span>(burglaryDataset<span class="sc">$</span>burglary)</span>
<span id="cb45-5"><a href="bayesian-generalised-linear-models-glms.html#cb45-5" tabindex="-1"></a></span>
<span id="cb45-6"><a href="bayesian-generalised-linear-models-glms.html#cb45-6" tabindex="-1"></a><span class="co"># visual distribution</span></span>
<span id="cb45-7"><a href="bayesian-generalised-linear-models-glms.html#cb45-7" tabindex="-1"></a><span class="fu">hist</span>(burglaryDataset<span class="sc">$</span>burglary, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600</span>),</span>
<span id="cb45-8"><a href="bayesian-generalised-linear-models-glms.html#cb45-8" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Report number of burglaries on a street segment&quot;</span>,</span>
<span id="cb45-9"><a href="bayesian-generalised-linear-models-glms.html#cb45-9" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>,</span>
<span id="cb45-10"><a href="bayesian-generalised-linear-models-glms.html#cb45-10" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Distribution of Burglary counts&quot;</span>)</span></code></pre></div>
<p><img src="images/general/Burglary_counts.png" width="100%" style="display: block; margin: auto;" /></p>
<p>The plot show evidence of over-dispersion. It indicates that a high number of streets in this city have less frequency of burglaries, while a few number of streets have reported excess number of burglaries. Here, we consider using a <strong>Negative Binomial Poisson regression model</strong> over the standard and zero-inflated versions (i.e., scenario 1 and 3).</p>
<p>Now, that we know the model type, let us estimate the over-dispersion parameter using the <code>glm.nb()</code> function.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="bayesian-generalised-linear-models-glms.html#cb46-1" tabindex="-1"></a><span class="co"># Fit negative binomial regression null model</span></span>
<span id="cb46-2"><a href="bayesian-generalised-linear-models-glms.html#cb46-2" tabindex="-1"></a>nb_model <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(burglary <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> burglaryDataset)</span>
<span id="cb46-3"><a href="bayesian-generalised-linear-models-glms.html#cb46-3" tabindex="-1"></a><span class="co"># Extract theta</span></span>
<span id="cb46-4"><a href="bayesian-generalised-linear-models-glms.html#cb46-4" tabindex="-1"></a>theta <span class="ot">&lt;-</span> nb_model<span class="sc">$</span>theta</span>
<span id="cb46-5"><a href="bayesian-generalised-linear-models-glms.html#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="bayesian-generalised-linear-models-glms.html#cb46-6" tabindex="-1"></a>theta</span>
<span id="cb46-7"><a href="bayesian-generalised-linear-models-glms.html#cb46-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.3161472</span></span></code></pre></div>
<p>The estimated over-dispersion parameter is <strong>0.3161472</strong>, which is small, this suggests that residential burglaries exhibits substantial over-dispersion. We will use this value in our Bayesian model when we code it in Stan.</p>
<div class="note">
<p><strong>Acknowledgements:</strong> Thanks to <strong>Fernando Rodriguez</strong> for pointing out that it is improper practice to fix the dispersion parameter in the model, and for advising that it is best practice to allow the model to estimate it instead. That part has been amended accordingly. Further thanks to <strong>Jacob Cohen</strong> for noting that the current approach to estimating the dispersion parameter should serve primarily as guidance only to help us understand the extent of dispersion in our data and inform the choice of a prior distribution accordingly.</p>
</div>
</div>
<div id="data-preparation-and-set-up-for-bayesian-analysis-in-stan" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Data preparation and set-up for Bayesian analysis in Stan<a href="bayesian-generalised-linear-models-glms.html#data-preparation-and-set-up-for-bayesian-analysis-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let begin with a model that only contains independent variables that are continuous measures i.e., distance and connectivity. We can prepare the dataset into <code>list()</code> object:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="bayesian-generalised-linear-models-glms.html#cb47-1" tabindex="-1"></a>stan_dataset_model1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(burglaryDataset),</span>
<span id="cb47-2"><a href="bayesian-generalised-linear-models-glms.html#cb47-2" tabindex="-1"></a>    <span class="at">burg =</span> burglaryDataset<span class="sc">$</span>burglary, </span>
<span id="cb47-3"><a href="bayesian-generalised-linear-models-glms.html#cb47-3" tabindex="-1"></a>    <span class="at">dist =</span> burglaryDataset<span class="sc">$</span>distance,</span>
<span id="cb47-4"><a href="bayesian-generalised-linear-models-glms.html#cb47-4" tabindex="-1"></a>    <span class="at">conn =</span> burglaryDataset<span class="sc">$</span>connectivity,</span>
<span id="cb47-5"><a href="bayesian-generalised-linear-models-glms.html#cb47-5" tabindex="-1"></a>    <span class="at">offset =</span> <span class="fu">log</span>(burglaryDataset<span class="sc">$</span>totalhouses)</span>
<span id="cb47-6"><a href="bayesian-generalised-linear-models-glms.html#cb47-6" tabindex="-1"></a>    )</span></code></pre></div>
<div class="note">
<p><strong>Important Notes:</strong> The list object <code>stan_dataset_model1</code> from RStudio is passed into the Stan.</p>
<ul>
<li><code>N = nrow(burglaryDataset)</code> we are extracting the number of observations present in the dataset. Note that this a smart way instead of hard coding the number. Note that here, <code>N</code> is <code>743</code>, meaning there 743 street segments.</li>
<li><code>burg = burglaryDataset$burglary</code>: Here, we defined the outcome variable (i.e., counts of burglaries) as <code>burg</code>.</li>
<li><code>dist = burglaryDataset$distance</code>: Independent variable for distance.</li>
<li><code>conn = burglaryDataset$connectivity</code>: Independent variable for connectivity.</li>
<li><code>off_set = log(burglaryDataset$totalhouses)</code>: Here, the <code>off_set</code> is calculated from taking the log-transform of the <code>totalhouses</code>, which is the denominators used for expressing the residential burglaries as a crime rate per capita.</li>
</ul>
</div>
<p>Let’s create our <strong>Stan script</strong> for running a <strong>Negative Binomial Poisson regression</strong> within a Bayesian framework.</p>
</div>
<div id="creating-a-script-to-run-a-negative-binomial-poisson-regression-in-stan" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Creating a script to run a Negative Binomial Poisson regression in Stan<a href="bayesian-generalised-linear-models-glms.html#creating-a-script-to-run-a-negative-binomial-poisson-regression-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A typical <strong>Stan</strong> program for a regression consist of the following 5 <strong>blocks</strong>:</p>
<ol style="list-style-type: decimal">
<li>Data</li>
<li>Parameters</li>
<li>Model</li>
<li>Generated quantities</li>
</ol>
<p>The <code>Data</code>, <code>Parameters</code> and <code>Model</code> block <strong>must</strong> be specified for the regression to work. But there will be additional block that we will need to transform the resultant parameters (i.e., coefficients) into relative risk (RR) inside the <code>Generated quantities</code> block.</p>
<p>Let’s start with the <code>data</code> block:</p>
<p><strong>FIRST STEP:</strong> We specify the total number of observations <code>N</code> as an <code>integer</code>, as well as the information we defined in our list object <code>stan_dataset_model1</code> to be passed to Stan. This information is specified in the <code>data</code> block:</p>
<pre class="text"><code>data {
    int&lt;lower=0&gt; N;                    // declare the overall number of data points to be passed into model
    array[N] int&lt;lower=0&gt; burg;        // define as an array and specify it as an integer for counts
    vector[N] dist;                    // continuous variable
    vector[N] conn;                    // continuous variable
    vector[N] off_set;                 // offset variable for the denominators (total households on a stree segment)
}</code></pre>
<p><strong>SECOND STEP:</strong> For the <code>parameters</code> block, here we will need to specify the name of the regression intercept <code>alpha</code>, which is baseline risk of residential burglaries, and the two coefficients i.e., <code>beta[1]</code> and <code>beta[2]</code> for our two independent variables <code>dist</code> and <code>conn</code> respectively. We will also create <code>phi</code>, a dispersion parameter, to mimic the behaviour of that shown in the histogram of Scenario 2 and the derived estimate of <strong><span class="math inline">\(\theta\)</span> = 0.3161472</strong> (<a href="">see section 4.2.1</a>)</p>
<pre class="text"><code>data {
    int&lt;lower=0&gt; N;                    // declare the overall number of data points to be passed into model
    array[N] int&lt;lower=0&gt; burg;        // define as an array and specify it as an integer for counts
    vector[N] dist;                    // continuous variable
    vector[N] conn;                    // continuous variable
    vector[N] off_set;                 // offset variable for the denominators (total households on a stree segment)
}

parameters {
    real alpha;
    real&lt;lower=0&gt; phi;
    vector[2] beta;
}</code></pre>
<p><strong>THIRD STEP:</strong> We build our likelihood function and specify the priors for each parameter under the <code>model</code> block. For all parameters - the priors have been centred around 0, meaning that broadly, these variables have no effect on residential burglaries, and if any, these effects may range from ±1SD (so in risk terms 0.36 to 2.71). The regression model is <code>neg_binomial_2_log(formula, Overdispersion)</code>:</p>
<pre class="text"><code>data {
    int&lt;lower=0&gt; N;                    // declare the overall number of data points to be passed into model
    array[N] int&lt;lower=0&gt; burg;        // define as an array and specify it as an integer for counts
    vector[N] dist;                    // continuous variable
    vector[N] conn;                    // continuous variable
    vector[N] off_set;                 // offset variable for the denominators (total households on a stree segment)
}

parameters {
    real alpha;
    real&lt;lower=0&gt; phi;
    vector[2] beta;
}

model {
    // prior specification for our parameters
    alpha ~ normal(0, 1);               
    beta[1] ~ normal(0, 1);
    beta[2] ~ normal(0, 1);
    phi ~ beta(2, 5)
    
    // likelihood function i.e., statistical model
    for (i in 1:N) {
        burg[i] ~ neg_binomial_2_log(alpha + beta[1]*dist[i] + beta[2]*conn[i] + offset[i], phi);
    }
}</code></pre>
<p><strong>LAST STEP:</strong> We instruct Stan to <code>generated quantitites</code> to calculate the <strong>relative risk ratio (RRs)</strong> by converting the estimated coefficients by using <code>exp()</code>. We ask it to calculate the log likelihood for model validation:</p>
<pre class="text"><code>data {
    int&lt;lower=0&gt; N;                    // declare the overall number of data points to be passed into model
    array[N] int&lt;lower=0&gt; burg;        // define as an array and specify it as an integer for counts
    vector[N] dist;                    // continuous variable
    vector[N] conn;                    // continuous variable
    vector[N] off_set;                 // offset variable for the denominators (total households on a stree segment)
}

parameters {
    real alpha;
    real&lt;lower=0&gt; phi;
    vector[2] beta;
}

model {
    // prior specification for our parameters
    alpha ~ normal(0, 1);               
    beta[1] ~ normal(0, 1);
    beta[2] ~ normal(0, 1);
    phi ~ beta(2, 5)
    
    // likelihood function i.e., statistical model
    for (i in 1:N) {
        burg[i] ~ neg_binomial_2_log(alpha + beta[1]*dist[i] + beta[2]*conn[i] + off_set[i], phi);
    }
}

generated quantities {
    // report crime risk ratios
    real baselineCrimeRR;
    vector[2] CrimeRR;
    baselineCrimeRR = exp(alpha);
    CrimeRR = exp(beta);
    
    // model validation and comparison
    vector[N] log_lik;                 
    for (i in 1:N) {
        log_lik[i] = neg_binomial_2_log_lpmf(burg[i] | alpha + beta[1]*dist[i] + beta[2]*conn[i] + off_set[i], phi);
    }
}</code></pre>
<p>Save the stan script as <code>Cont_Model_1.stan</code>.</p>
</div>
<div id="compiling-our-stan-code-in-rstudio-and-results" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Compiling our Stan code in RStudio and Results<a href="bayesian-generalised-linear-models-glms.html#compiling-our-stan-code-in-rstudio-and-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, let us turn our attention to RStudio. Using the <code>stan()</code> to compile and obtain the posterior estimation of the overall risk and crime risk ratios (CRR) for the each independent variable:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="bayesian-generalised-linear-models-glms.html#cb52-1" tabindex="-1"></a><span class="co"># the directory needs to be set to where you saved the dataset and Stan script</span></span>
<span id="cb52-2"><a href="bayesian-generalised-linear-models-glms.html#cb52-2" tabindex="-1"></a>crr.negbin.model1 <span class="ot">=</span> <span class="fu">stan</span>(<span class="st">&quot;Cont_Model_1.stan&quot;</span>, <span class="at">data=</span>stan_dataset_model1, <span class="at">iter=</span><span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">6</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We can print the results accordingly:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="bayesian-generalised-linear-models-glms.html#cb53-1" tabindex="-1"></a><span class="co"># reports all results</span></span>
<span id="cb53-2"><a href="bayesian-generalised-linear-models-glms.html#cb53-2" tabindex="-1"></a><span class="fu">print</span>(crr.negbin.model1, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;baselineCrimeRR&quot;</span>, <span class="st">&quot;CrimeRR&quot;</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<p><strong>Output summary table</strong></p>
<pre class="text"><code>Inference for Stan model: anon_model.
6 chains, each with iter=3000; warmup=1500; thin=1; 
post-warmup draws per chain=1500, total post-warmup draws=9000.

                 mean se_mean   sd  2.5% 97.5% n_eff Rhat
alpha           -2.16       0 0.13 -2.42 -1.91  3282    1
beta[1]          0.00       0 0.00  0.00  0.00  4237    1
beta[2]          0.06       0 0.02  0.02  0.11  3216    1
baselineCrimeRR  0.12       0 0.02  0.09  0.15  3225    1
CrimeRR[1]       1.00       0 0.00  1.00  1.00  4236    1
CrimeRR[2]       1.07       0 0.02  1.02  1.11  3215    1

Samples were drawn using NUTS(diag_e) at Fri Jan 24 02:30:42 2025.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
<p>Here is the messing part - <strong>interpretation</strong>. Before anything, note that <code>alpha</code>, <code>beta[1]</code> and <code>beta[2]</code> corresponds to the intercept, and coefficients for distance and connectivity, respectively. These are on the log-scale!</p>
<p>The risk ratios from <code>alpha</code>, <code>beta[1]</code> and <code>beta[2]</code> which, in turn, corresponds to the intercept, and coefficients for distance and connectivity, respectively, are the <code>baselineCrimeRR</code>, <code>CrimeRR[1]</code> and <code>CrimeRR[2]</code>. For instance, the significant result is for connectivity, which shows for every unit increase in the number to street connections on a segment in the network, the risk of residential burglaries increase by 1.07 (7%), which is significant based on its 95% Credibility Interval (95 CrI: 1.02-1.11).</p>
<p>We can compute exceedance probabilities i.e., that such risk concerning connectivity are greater than 1 (meaning there’s an excess risk):</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="bayesian-generalised-linear-models-glms.html#cb55-1" tabindex="-1"></a><span class="co"># Here, we can extract the simulated sample for CrimeRR[2]</span></span>
<span id="cb55-2"><a href="bayesian-generalised-linear-models-glms.html#cb55-2" tabindex="-1"></a>conn_draws <span class="ot">&lt;-</span> <span class="fu">extract</span>(crr.negbin.model1, <span class="st">&#39;CrimeRR[2]&#39;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb55-3"><a href="bayesian-generalised-linear-models-glms.html#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="bayesian-generalised-linear-models-glms.html#cb55-4" tabindex="-1"></a><span class="fu">mean</span>(conn_draws <span class="sc">&gt;</span> <span class="fl">1.00</span>)</span>
<span id="cb55-5"><a href="bayesian-generalised-linear-models-glms.html#cb55-5" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9977778</span></span></code></pre></div>
<p>This indicates a strong chance (99.7%) that streets with more connections to other street segments in the network will certainly increase the risk of residential burglaries.</p>
<p>Lastly, we will assess the validity of our model using a test called <strong>Leave-One-Out Cross-Validation</strong>. The estimate from this test <strong>Expected Log Predictive Density (ELPD)</strong> quantifies how well a model performs and so higher values of <strong>ELPD</strong> indicates better predictive performance. While, it can be interpreted on its own, its primary value lies in model comparison rather than as an absolute measure.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="bayesian-generalised-linear-models-glms.html#cb56-1" tabindex="-1"></a><span class="co"># extracting ELPD leave-one-out results from model with continuous variables only</span></span>
<span id="cb56-2"><a href="bayesian-generalised-linear-models-glms.html#cb56-2" tabindex="-1"></a>log_lik_with_cont <span class="ot">&lt;-</span> <span class="fu">extract_log_lik</span>(crr.negbin.model1, <span class="at">merge_chains =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-3"><a href="bayesian-generalised-linear-models-glms.html#cb56-3" tabindex="-1"></a>r_eff_with_cont <span class="ot">&lt;-</span> <span class="fu">relative_eff</span>(log_lik_with_cont)</span>
<span id="cb56-4"><a href="bayesian-generalised-linear-models-glms.html#cb56-4" tabindex="-1"></a>loo_cont <span class="ot">&lt;-</span> <span class="fu">loo</span>(log_lik_with_cont, r_eff_with_cont, <span class="at">cores =</span> <span class="dv">6</span>)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="bayesian-generalised-linear-models-glms.html#cb57-1" tabindex="-1"></a><span class="fu">print</span>(loo_cont)</span>
<span id="cb57-2"><a href="bayesian-generalised-linear-models-glms.html#cb57-2" tabindex="-1"></a></span>
<span id="cb57-3"><a href="bayesian-generalised-linear-models-glms.html#cb57-3" tabindex="-1"></a>Computed from <span class="dv">9000</span> by <span class="dv">743</span> log<span class="sc">-</span>likelihood matrix.</span>
<span id="cb57-4"><a href="bayesian-generalised-linear-models-glms.html#cb57-4" tabindex="-1"></a></span>
<span id="cb57-5"><a href="bayesian-generalised-linear-models-glms.html#cb57-5" tabindex="-1"></a>         Estimate   SE</span>
<span id="cb57-6"><a href="bayesian-generalised-linear-models-glms.html#cb57-6" tabindex="-1"></a>elpd_loo  <span class="sc">-</span><span class="fl">1022.1</span> <span class="fl">37.7</span></span>
<span id="cb57-7"><a href="bayesian-generalised-linear-models-glms.html#cb57-7" tabindex="-1"></a>p_loo         <span class="fl">2.6</span>  <span class="fl">0.4</span></span>
<span id="cb57-8"><a href="bayesian-generalised-linear-models-glms.html#cb57-8" tabindex="-1"></a>looic      <span class="fl">2044.3</span> <span class="fl">75.3</span></span>
<span id="cb57-9"><a href="bayesian-generalised-linear-models-glms.html#cb57-9" tabindex="-1"></a><span class="sc">------</span></span>
<span id="cb57-10"><a href="bayesian-generalised-linear-models-glms.html#cb57-10" tabindex="-1"></a>MCSE of elpd_loo is <span class="dv">0</span>.<span class="fl">0.</span></span>
<span id="cb57-11"><a href="bayesian-generalised-linear-models-glms.html#cb57-11" tabindex="-1"></a>MCSE and ESS estimates assume independent <span class="fu">draws</span> (<span class="at">r_eff=</span><span class="dv">1</span>).</span>
<span id="cb57-12"><a href="bayesian-generalised-linear-models-glms.html#cb57-12" tabindex="-1"></a></span>
<span id="cb57-13"><a href="bayesian-generalised-linear-models-glms.html#cb57-13" tabindex="-1"></a>All Pareto k estimates are <span class="fu">good</span> (k <span class="sc">&lt;</span> <span class="fl">0.7</span>).</span>
<span id="cb57-14"><a href="bayesian-generalised-linear-models-glms.html#cb57-14" tabindex="-1"></a>See <span class="fu">help</span>(<span class="st">&#39;pareto-k-diagnostic&#39;</span>) <span class="cf">for</span> details.</span></code></pre></div>
<p>We take note that the ELPD is <code>-1022.1</code></p>
</div>
<div id="model-with-categorical-variables" class="section level3 hasAnchor" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Model with categorical variables<a href="bayesian-generalised-linear-models-glms.html#model-with-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The purpose of this section is to show:</p>
<ul>
<li>How to include categorical variables into the model</li>
<li>Perform model comparisons</li>
</ul>
<p>Let’s include the following categorical variables: <code>integq</code> and <code>choiceq</code> into the regression. Each variable has four categories, we want to omit the first category as it represents the lowest exposure group, and use it a reference for the higher categories when we estimate their risk.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="bayesian-generalised-linear-models-glms.html#cb58-1" tabindex="-1"></a><span class="co"># See table for categorical variables</span></span>
<span id="cb58-2"><a href="bayesian-generalised-linear-models-glms.html#cb58-2" tabindex="-1"></a><span class="fu">table</span>(burglaryDataset<span class="sc">$</span>choiceq)</span>
<span id="cb58-3"><a href="bayesian-generalised-linear-models-glms.html#cb58-3" tabindex="-1"></a><span class="fu">table</span>(burglaryDataset<span class="sc">$</span>integq)</span>
<span id="cb58-4"><a href="bayesian-generalised-linear-models-glms.html#cb58-4" tabindex="-1"></a></span>
<span id="cb58-5"><a href="bayesian-generalised-linear-models-glms.html#cb58-5" tabindex="-1"></a><span class="co"># Create dummy variables for choice</span></span>
<span id="cb58-6"><a href="bayesian-generalised-linear-models-glms.html#cb58-6" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>choicecat2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>choiceq <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-7"><a href="bayesian-generalised-linear-models-glms.html#cb58-7" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>choicecat3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>choiceq <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-8"><a href="bayesian-generalised-linear-models-glms.html#cb58-8" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>choicecat4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>choiceq <span class="sc">==</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-9"><a href="bayesian-generalised-linear-models-glms.html#cb58-9" tabindex="-1"></a></span>
<span id="cb58-10"><a href="bayesian-generalised-linear-models-glms.html#cb58-10" tabindex="-1"></a><span class="co"># Create dummy variables for integration</span></span>
<span id="cb58-11"><a href="bayesian-generalised-linear-models-glms.html#cb58-11" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>integ2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>integq <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-12"><a href="bayesian-generalised-linear-models-glms.html#cb58-12" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>integ3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>integq <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-13"><a href="bayesian-generalised-linear-models-glms.html#cb58-13" tabindex="-1"></a>burglaryDataset<span class="sc">$</span>integ4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(burglaryDataset<span class="sc">$</span>integq <span class="sc">==</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>Let us expand the model to include independent variables that are both continuous and categorical measures i.e., distance and connectivity, choice and integration, and the new information into a <code>list()</code> object:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="bayesian-generalised-linear-models-glms.html#cb59-1" tabindex="-1"></a>stan_dataset_model2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(burglaryDataset),</span>
<span id="cb59-2"><a href="bayesian-generalised-linear-models-glms.html#cb59-2" tabindex="-1"></a>    <span class="at">burg =</span> burglaryDataset<span class="sc">$</span>burglary, </span>
<span id="cb59-3"><a href="bayesian-generalised-linear-models-glms.html#cb59-3" tabindex="-1"></a>    <span class="at">dist =</span> burglaryDataset<span class="sc">$</span>distance,</span>
<span id="cb59-4"><a href="bayesian-generalised-linear-models-glms.html#cb59-4" tabindex="-1"></a>    <span class="at">conn =</span> burglaryDataset<span class="sc">$</span>connectivity,</span>
<span id="cb59-5"><a href="bayesian-generalised-linear-models-glms.html#cb59-5" tabindex="-1"></a>    <span class="at">chcat2 =</span> burglaryDataset<span class="sc">$</span>choicecat2,</span>
<span id="cb59-6"><a href="bayesian-generalised-linear-models-glms.html#cb59-6" tabindex="-1"></a>    <span class="at">chcat3 =</span> burglaryDataset<span class="sc">$</span>choicecat3,</span>
<span id="cb59-7"><a href="bayesian-generalised-linear-models-glms.html#cb59-7" tabindex="-1"></a>    <span class="at">chcat4 =</span> burglaryDataset<span class="sc">$</span>choicecat4,</span>
<span id="cb59-8"><a href="bayesian-generalised-linear-models-glms.html#cb59-8" tabindex="-1"></a>    <span class="at">intcat2 =</span> burglaryDataset<span class="sc">$</span>integ2,</span>
<span id="cb59-9"><a href="bayesian-generalised-linear-models-glms.html#cb59-9" tabindex="-1"></a>    <span class="at">intcat3 =</span> burglaryDataset<span class="sc">$</span>integ3,</span>
<span id="cb59-10"><a href="bayesian-generalised-linear-models-glms.html#cb59-10" tabindex="-1"></a>    <span class="at">intcat4 =</span> burglaryDataset<span class="sc">$</span>integ4,</span>
<span id="cb59-11"><a href="bayesian-generalised-linear-models-glms.html#cb59-11" tabindex="-1"></a>    <span class="at">off_set =</span> <span class="fu">log</span>(burglaryDataset<span class="sc">$</span>totalhouses)</span>
<span id="cb59-12"><a href="bayesian-generalised-linear-models-glms.html#cb59-12" tabindex="-1"></a>    )</span></code></pre></div>
<p>The amended Stan code will look something as follows:</p>
<pre class="text"><code>data {
    int&lt;lower=0&gt; N;                    // declare the overall number of data points to be passed into model
    array[N] int&lt;lower=0&gt; burg;        // define as an array and specify it as an integer for counts
    vector[N] dist;                    // continuous variable
    vector[N] conn;                    // continuous variable
    vector[N] chcat2;
    vector[N] chcat3;
    vector[N] chcat4;
    vector[N] intcat2;
    vector[N] intcat3;
    vector[N] intcat4;
    vector[N] off_set;                 // offset variable for the denominators (total households on a stree segment)
}

parameters {
    real alpha;
    real&lt;lower=0&gt; phi;
    vector[2] beta;
    vector[3] chcq;
    vector[3] intq;
}

model {
    // prior specification for our parameters
    alpha ~ normal(0, 1);               
    beta ~ normal(0, 1);
    chcq  ~ normal(0, 1);
    intq  ~ normal(0, 1);
    phi ~ beta(2, 5)
    
    // likelihood function i.e., statistical model
    for (i in 1:N) {
        burg[i] ~ neg_binomial_2_log(alpha + beta[1]*dist[i] + beta[2]*conn[i] + chcq[1]*chcat2[i] + chcq[2]*chcat3[i] + chcq[3]*chcat4[i] + intq[1]*intcat2[i] + intq[2]*intcat3[i] + intq[3]*intcat4[i] + off_set[i], phi);
    }
}

generated quantities {
    // report crime risk ratios
    real baselineCrimeRR;
    vector[2] betaRR;
    vector[3] chcqRR;
    vector[3] intqRR;
    baselineCrimeRR = exp(alpha);
    betaRR = exp(beta);
    chcqRR = exp(chcq);
    intqRR = exp(intq);
    
    // model validation and comparison
    vector[N] log_lik;                 
    for (i in 1:N) {
        log_lik[i] = neg_binomial_2_log_lpmf(burg[i] | alpha + beta[1]*dist[i] + beta[2]*conn[i] + chcq[1]*chcat2[i] + chcq[2]*chcat3[i] + chcq[3]*chcat4[i] + intq[1]*intcat2[i] + intq[2]*intcat3[i] + intq[3]*intcat4[i] + off_set[i], phi);
    }
}</code></pre>
<p>Please save the Stan script as <code>Cat_Model_2.stan</code>.</p>
<p>We can use the <code>stan()</code> to compile the updated code to obtain the posterior estimation accordingly:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="bayesian-generalised-linear-models-glms.html#cb61-1" tabindex="-1"></a><span class="co"># the directory needs to be set to where you saved the dataset and Stan script</span></span>
<span id="cb61-2"><a href="bayesian-generalised-linear-models-glms.html#cb61-2" tabindex="-1"></a>crr.negbin.model2 <span class="ot">=</span> <span class="fu">stan</span>(<span class="st">&quot;Cat_Model_2.stan&quot;</span>, <span class="at">data=</span>stan_dataset_model2, <span class="at">iter=</span><span class="dv">3000</span>, <span class="at">chains=</span><span class="dv">6</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We can print the results accordingly:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="bayesian-generalised-linear-models-glms.html#cb62-1" tabindex="-1"></a><span class="co"># reports all results</span></span>
<span id="cb62-2"><a href="bayesian-generalised-linear-models-glms.html#cb62-2" tabindex="-1"></a><span class="fu">print</span>(crr.negbin.model2, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;baselineCrimeRR&quot;</span>, <span class="st">&quot;betaRR&quot;</span>, <span class="st">&quot;chcqRR&quot;</span>, <span class="st">&quot;intqRR&quot;</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<p><strong>Output summary table</strong></p>
<pre class="text"><code>Inference for Stan model: anon_model.
6 chains, each with iter=3000; warmup=1500; thin=1; 
post-warmup draws per chain=1500, total post-warmup draws=9000.

                mean se_mean   sd 2.5% 97.5% n_eff Rhat
baselineCrimeRR 0.13       0 0.03 0.09  0.20  4190    1
betaRR[1]       1.00       0 0.00 1.00  1.00 11128    1
betaRR[2]       1.08       0 0.03 1.03  1.14  5524    1
chcqRR[1]       0.95       0 0.21 0.60  1.44  4692    1
chcqRR[2]       0.94       0 0.23 0.57  1.46  4593    1
chcqRR[3]       0.86       0 0.29 0.44  1.55  4266    1
intqRR[1]       0.94       0 0.20 0.61  1.39  5311    1
intqRR[2]       0.84       0 0.18 0.54  1.25  5119    1
intqRR[3]       0.81       0 0.19 0.49  1.24  5302    1

Samples were drawn using NUTS(diag_e) at Fri Jan 24 03:34:39 2025.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
<p>We can compare this model against the previous one to see which one highest ELPD value for better predictive performance.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="bayesian-generalised-linear-models-glms.html#cb64-1" tabindex="-1"></a><span class="co"># extracting ELPD leave-one-out results from model with both continuous and categorical variables</span></span>
<span id="cb64-2"><a href="bayesian-generalised-linear-models-glms.html#cb64-2" tabindex="-1"></a>log_lik_with_cat <span class="ot">&lt;-</span> <span class="fu">extract_log_lik</span>(crr.negbin.model2, <span class="at">merge_chains =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-3"><a href="bayesian-generalised-linear-models-glms.html#cb64-3" tabindex="-1"></a>r_eff_with_cat <span class="ot">&lt;-</span> <span class="fu">relative_eff</span>(log_lik_with_cat)</span>
<span id="cb64-4"><a href="bayesian-generalised-linear-models-glms.html#cb64-4" tabindex="-1"></a>loo_cat <span class="ot">&lt;-</span> <span class="fu">loo</span>(log_lik_with_cat, r_eff_with_cat, <span class="at">cores =</span> <span class="dv">6</span>)</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="bayesian-generalised-linear-models-glms.html#cb65-1" tabindex="-1"></a><span class="fu">print</span>(loo_cat)</span>
<span id="cb65-2"><a href="bayesian-generalised-linear-models-glms.html#cb65-2" tabindex="-1"></a></span>
<span id="cb65-3"><a href="bayesian-generalised-linear-models-glms.html#cb65-3" tabindex="-1"></a>Computed from <span class="dv">9000</span> by <span class="dv">743</span> log<span class="sc">-</span>likelihood matrix.</span>
<span id="cb65-4"><a href="bayesian-generalised-linear-models-glms.html#cb65-4" tabindex="-1"></a></span>
<span id="cb65-5"><a href="bayesian-generalised-linear-models-glms.html#cb65-5" tabindex="-1"></a>         Estimate   SE</span>
<span id="cb65-6"><a href="bayesian-generalised-linear-models-glms.html#cb65-6" tabindex="-1"></a>elpd_loo  <span class="sc">-</span><span class="fl">1026.7</span> <span class="fl">37.7</span></span>
<span id="cb65-7"><a href="bayesian-generalised-linear-models-glms.html#cb65-7" tabindex="-1"></a>p_loo         <span class="fl">7.7</span>  <span class="fl">1.0</span></span>
<span id="cb65-8"><a href="bayesian-generalised-linear-models-glms.html#cb65-8" tabindex="-1"></a>looic      <span class="fl">2053.4</span> <span class="fl">75.4</span></span>
<span id="cb65-9"><a href="bayesian-generalised-linear-models-glms.html#cb65-9" tabindex="-1"></a><span class="sc">------</span></span>
<span id="cb65-10"><a href="bayesian-generalised-linear-models-glms.html#cb65-10" tabindex="-1"></a>MCSE of elpd_loo is <span class="dv">0</span>.<span class="fl">0.</span></span>
<span id="cb65-11"><a href="bayesian-generalised-linear-models-glms.html#cb65-11" tabindex="-1"></a>MCSE and ESS estimates assume independent <span class="fu">draws</span> (<span class="at">r_eff=</span><span class="dv">1</span>).</span>
<span id="cb65-12"><a href="bayesian-generalised-linear-models-glms.html#cb65-12" tabindex="-1"></a></span>
<span id="cb65-13"><a href="bayesian-generalised-linear-models-glms.html#cb65-13" tabindex="-1"></a>All Pareto k estimates are <span class="fu">good</span> (k <span class="sc">&lt;</span> <span class="fl">0.7</span>).</span>
<span id="cb65-14"><a href="bayesian-generalised-linear-models-glms.html#cb65-14" tabindex="-1"></a>See <span class="fu">help</span>(<span class="st">&#39;pareto-k-diagnostic&#39;</span>) <span class="cf">for</span> details.</span></code></pre></div>
<p>This first model’s ELPD was <code>-1022.1</code>, and full model’s show <code>-1026.7</code>. Based on this result, it is clear that the first model is better in terms of predictive performance since its <strong>ELPD</strong> is higher (i.e., <code>-1022.1</code> vs <code>-1026.7</code>). So its best to stick with the first model, unless there is a strong theoretical reason to use second model (i.e., accounting for confounding).</p>
</div>
</div>
<div id="tasks-2" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Tasks<a href="bayesian-generalised-linear-models-glms.html#tasks-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="task-1---obesity-and-fastfoods-in-london" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Task 1 - Obesity and Fastfoods in London<a href="bayesian-generalised-linear-models-glms.html#task-1---obesity-and-fastfoods-in-london" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Accessibility to junk food restaurants in young adolescents especially after school hours is a growing cause for concern. Especially, now that many young adults have a sedentary lifestyle; hence obesity rates among this population is increasing in the UK.</p>
<p><strong>Try this problem in Stan</strong>: Use the dataset <code>Obesity and Fastfoods in MSOAs data.csv</code> to determine the links between prevalence of obesity in high school students and density of fast food (cheap) restaurant and deprivation in MSOAs in London. Implement a Bayesian GLM using <strong>Stan</strong> code.</p>
<p><strong>Variable names:</strong></p>
<ul>
<li><code>SEQID</code>: ID number for row</li>
<li><code>MSOA11CD</code>: Unique identifier for MSOA area</li>
<li><code>MSOA11NM</code>: Name of the MSOA area</li>
<li><code>OBESE</code>: Number of child identified as obese in MSOA in London</li>
<li><code>TOTAL</code>: Total number of children surveyed for BMI measurements</li>
<li><code>IMDMSOA</code>: Area-level socioeconomic deprivation score (higher scores means higher deprivation and vice versa)</li>
<li><code>RESTCAT</code>: Categorical variable for classifying an MSOA in terms of density of junk/cheap fast food outlets restaurants: <code>1 = 1 to 10</code>, <code>2= 11 to 25</code>, <code>3= 26 to 50</code> and <code>4= 51 to 300</code>.</li>
</ul>
<p><strong>HINT</strong>: You might want to consider using the following functions: <code>binomial_logit()</code> or <code>binomial()</code> in the <strong>model</strong> block and reporting the <strong>odd ratios</strong> using the <strong>generated quantities</strong> block. You might want to consider computing the exceedance probabilities for the <strong>odd ratios</strong> using the threshold of 1.</p>
</div>
<div id="task-2---factors-affecting-house-prices-in-london-2015" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Task 2 - Factors affecting house prices in London (2015)<a href="bayesian-generalised-linear-models-glms.html#task-2---factors-affecting-house-prices-in-london-2015" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Try this problem in Stan</strong>: Use <code>London LSOA 2015 data.csv</code> data pertained house prices in 2015, and assess it’s relationship with public transport accessibility (PTA), average income and socioeconomic deprivation (IMD) as the independent variables. Implement a Bayesian GLM using Stan code.</p>
<p><strong>Variables names:</strong></p>
<ul>
<li><code>LSOACODE</code>: Unique identification code for the geographic area</li>
<li><code>AVEPRICE</code>: (Dependent variable) Average house price estimated for the LSOA in 2015</li>
<li><code>AVEINCOME</code>: Estimated average annual income for households within an LSOA in 2015</li>
<li><code>IMDSCORE</code>: Deprivation score for an LSOA in 2015</li>
<li><code>PTAINDEX</code>: Measures levels of access/connectivity to public transport</li>
</ul>
<p><strong>HINT</strong>: You might want to consider using the following functions: <code>normal()</code> in the <strong>model</strong> block. You might want to consider computing the exceedance probabilities for the <strong>coefficients</strong> using the threshold of 0.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-bayesian-inference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-hierarchical-regression-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": false
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/UCLPG-MSC-SGDS/UCL-SODA-CPD-RStan/edit/main/intro_to_Bayesian_Regression_in_Stan.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
